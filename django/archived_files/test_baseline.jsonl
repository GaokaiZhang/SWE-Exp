{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16255", "model_patch": "--- a/django/contrib/sitemaps/__init__.py\n+++ b/django/contrib/sitemaps/__init__.py\n@@ -168,7 +168,7 @@\n         if callable(self.lastmod):\n             try:\n                 return max([self.lastmod(item) for item in self.items()])\n-            except TypeError:\n+            except (TypeError, ValueError):\n                 return None\n         else:\n             return self.lastmod\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16255/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16256", "model_patch": "--- a/django/db/models/fields/related_descriptors.py\n+++ b/django/db/models/fields/related_descriptors.py\n@@ -793,6 +793,11 @@\n \n         create.alters_data = True\n \n+        async def acreate(self, **kwargs):\n+            return await sync_to_async(self.create)(**kwargs)\n+\n+        acreate.alters_data = True\n+\n         def get_or_create(self, **kwargs):\n             self._check_fk_val()\n             kwargs[self.field.name] = self.instance\n@@ -801,6 +806,11 @@\n \n         get_or_create.alters_data = True\n \n+        async def aget_or_create(self, **kwargs):\n+            return await sync_to_async(self.get_or_create)(**kwargs)\n+\n+        aget_or_create.alters_data = True\n+\n         def update_or_create(self, **kwargs):\n             self._check_fk_val()\n             kwargs[self.field.name] = self.instance\n@@ -808,6 +818,11 @@\n             return super(RelatedManager, self.db_manager(db)).update_or_create(**kwargs)\n \n         update_or_create.alters_data = True\n+\n+        async def aupdate_or_create(self, **kwargs):\n+            return await sync_to_async(self.update_or_create)(**kwargs)\n+\n+        aupdate_or_create.alters_data = True\n \n         # remove() and clear() are only provided if the ForeignKey can have a\n         # value of null.\n@@ -1191,6 +1206,11 @@\n \n         create.alters_data = True\n \n+        async def acreate(self, *, through_defaults=None, **kwargs):\n+            return await sync_to_async(self.create)(through_defaults=through_defaults, **kwargs)\n+\n+        acreate.alters_data = True\n+\n         def get_or_create(self, *, through_defaults=None, **kwargs):\n             db = router.db_for_write(self.instance.__class__, instance=self.instance)\n             obj, created = super(ManyRelatedManager, self.db_manager(db)).get_or_create(\n@@ -1203,6 +1223,11 @@\n             return obj, created\n \n         get_or_create.alters_data = True\n+\n+        async def aget_or_create(self, *, through_defaults=None, **kwargs):\n+            return await sync_to_async(self.get_or_create)(through_defaults=through_defaults, **kwargs)\n+\n+        aget_or_create.alters_data = True\n \n         def update_or_create(self, *, through_defaults=None, **kwargs):\n             db = router.db_for_write(self.instance.__class__, instance=self.instance)\n@@ -1216,6 +1241,11 @@\n             return obj, created\n \n         update_or_create.alters_data = True\n+\n+        async def aupdate_or_create(self, *, through_defaults=None, **kwargs):\n+            return await sync_to_async(self.update_or_create)(through_defaults=through_defaults, **kwargs)\n+\n+        aupdate_or_create.alters_data = True\n \n         def _get_target_ids(self, target_field_name, objs):\n             \"\"\"\n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-16256/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16263", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -545,11 +545,96 @@\n \n         return dict(zip(outer_query.annotation_select, result))\n \n+    def get_referenced_annotations(self):\n+        \"\"\"\n+        Return a set of annotation names that are actually referenced by\n+        the WHERE clause, ORDER BY clause, or other annotations.\n+        \"\"\"\n+        referenced = set()\n+        \n+        # Check WHERE clause for annotation references\n+        def collect_annotation_refs(node):\n+            if hasattr(node, 'children'):\n+                for child in node.children:\n+                    collect_annotation_refs(child)\n+            elif hasattr(node, 'lhs') and hasattr(node.lhs, 'target'):\n+                # Check if this is a lookup that references an annotation\n+                if hasattr(node.lhs.target, 'name') and node.lhs.target.name in self.annotations:\n+                    referenced.add(node.lhs.target.name)\n+            elif hasattr(node, 'lookup_name'):\n+                # Handle field lookups that might reference annotations\n+                lookup_parts = []\n+                if hasattr(node, 'lhs') and hasattr(node.lhs, 'source'):\n+                    source = node.lhs.source\n+                    if hasattr(source, 'name'):\n+                        lookup_parts = [source.name]\n+                elif hasattr(node, 'lhs') and hasattr(node.lhs, 'target') and hasattr(node.lhs.target, 'name'):\n+                    lookup_parts = [node.lhs.target.name]\n+                \n+                if lookup_parts:\n+                    annotation, _ = refs_expression(lookup_parts, self.annotations)\n+                    if annotation:\n+                        referenced.add(lookup_parts[0])\n+        \n+        collect_annotation_refs(self.where)\n+        \n+        # Check ORDER BY clause for annotation references\n+        for order_item in self.order_by:\n+            if isinstance(order_item, str):\n+                # Handle string-based ordering like 'field_name' or '-field_name'\n+                field_name = order_item.lstrip('-')\n+                if field_name in self.annotations:\n+                    referenced.add(field_name)\n+            elif hasattr(order_item, 'expression'):\n+                # Handle expression-based ordering\n+                expr = order_item.expression\n+                if hasattr(expr, 'name') and expr.name in self.annotations:\n+                    referenced.add(expr.name)\n+        \n+        # Check annotations that reference other annotations\n+        def check_annotation_dependencies(annotation, visited=None):\n+            if visited is None:\n+                visited = set()\n+            \n+            if hasattr(annotation, 'get_source_expressions'):\n+                for source_expr in annotation.get_source_expressions():\n+                    if hasattr(source_expr, 'name') and source_expr.name in self.annotations:\n+                        if source_expr.name not in visited:\n+                            referenced.add(source_expr.name)\n+                            visited.add(source_expr.name)\n+                            check_annotation_dependencies(self.annotations[source_expr.name], visited)\n+                    else:\n+                        check_annotation_dependencies(source_expr, visited)\n+        \n+        # Start with annotations that are already referenced and find their dependencies\n+        initial_refs = referenced.copy()\n+        for ref_name in initial_refs:\n+            if ref_name in self.annotations:\n+                check_annotation_dependencies(self.annotations[ref_name])\n+        \n+        return referenced\n+    \n     def get_count(self, using):\n         \"\"\"\n         Perform a COUNT() query using the current filter constraints.\n         \"\"\"\n         obj = self.clone()\n+        \n+        # Optimize by only keeping annotations that are actually referenced\n+        if obj.annotations:\n+            referenced_annotations = obj.get_referenced_annotations()\n+            # Keep only the annotations that are referenced\n+            obj.annotations = {\n+                alias: annotation\n+                for alias, annotation in obj.annotations.items()\n+                if alias in referenced_annotations\n+            }\n+            # Update annotation select mask if it exists\n+            if obj.annotation_select_mask is not None:\n+                obj.annotation_select_mask = obj.annotation_select_mask.intersection(referenced_annotations)\n+            # Clear the annotation select cache\n+            obj._annotation_select_cache = None\n+        \n         obj.add_annotation(Count(\"*\"), alias=\"__count\", is_summary=True)\n         return obj.get_aggregation(using, [\"__count\"])[\"__count\"]\n \n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-16263/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16315", "model_patch": "--- a/django/db/backends/postgresql/operations.py\n+++ b/django/db/backends/postgresql/operations.py\n@@ -354,11 +354,11 @@\n             return \"ON CONFLICT DO NOTHING\"\n         if on_conflict == OnConflict.UPDATE:\n             return \"ON CONFLICT(%s) DO UPDATE SET %s\" % (\n-                \", \".join(map(self.quote_name, unique_fields)),\n+                \", \".join(map(self.quote_name, (f.column for f in unique_fields))),\n                 \", \".join(\n                     [\n-                        f\"{field} = EXCLUDED.{field}\"\n-                        for field in map(self.quote_name, update_fields)\n+                        f\"{self.quote_name(field.column)} = EXCLUDED.{self.quote_name(field.column)}\"\n+                        for field in update_fields\n                     ]\n                 ),\n             )\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-16315/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16333", "model_patch": "--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -141,6 +141,9 @@\n         user.set_password(self.cleaned_data[\"password1\"])\n         if commit:\n             user.save()\n+            self._save_m2m()\n+        else:\n+            self.save_m2m = self._save_m2m\n         return user\n \n \n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16333/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16429", "model_patch": "--- a/django/utils/timesince.py\n+++ b/django/utils/timesince.py\n@@ -97,6 +97,8 @@\n             d.hour,\n             d.minute,\n             d.second,\n+            0,\n+            d.tzinfo,\n         )\n     else:\n         pivot = d\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16429/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16454", "model_patch": "--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -70,6 +70,28 @@\n             super().error(message)\n         else:\n             raise CommandError(\"Error: %s\" % message)\n+\n+    def add_subparsers(self, **kwargs):\n+        # Ensure parser_class defaults to CommandParser\n+        kwargs.setdefault(\"parser_class\", CommandParser)\n+        \n+        # Call parent's add_subparsers method\n+        action = super().add_subparsers(**kwargs)\n+        \n+        # Store the original add_parser method\n+        original_add_parser = action.add_parser\n+        \n+        # Wrap the add_parser method to pass through CommandParser parameters\n+        def wrapped_add_parser(name, **parser_kwargs):\n+            # Pass through the CommandParser's special parameters\n+            parser_kwargs.setdefault('missing_args_message', self.missing_args_message)\n+            parser_kwargs.setdefault('called_from_command_line', self.called_from_command_line)\n+            return original_add_parser(name, **parser_kwargs)\n+        \n+        # Replace the add_parser method with our wrapped version\n+        action.add_parser = wrapped_add_parser\n+        \n+        return action\n \n \n def handle_default_options(options):\n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-16454/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16485", "model_patch": "--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -184,6 +184,7 @@\n     units = len(tupl[1])\n     units += -tupl[2] if m else tupl[2]\n     prec = abs(p) + units + 1\n+    prec = max(1, prec)\n \n     # Avoid conversion to scientific notation by accessing `sign`, `digits`,\n     # and `exponent` from Decimal.as_tuple() directly.\n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-16485/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16493", "model_patch": "--- a/django/db/models/fields/files.py\n+++ b/django/db/models/fields/files.py\n@@ -295,7 +295,7 @@\n         if kwargs.get(\"max_length\") == 100:\n             del kwargs[\"max_length\"]\n         kwargs[\"upload_to\"] = self.upload_to\n-        if self.storage is not default_storage:\n+        if self.storage is not default_storage or hasattr(self, \"_storage_callable\"):\n             kwargs[\"storage\"] = getattr(self, \"_storage_callable\", self.storage)\n         return name, path, args, kwargs\n \n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16493/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16502", "model_patch": "--- a/django/core/servers/basehttp.py\n+++ b/django/core/servers/basehttp.py\n@@ -142,6 +142,13 @@\n         # application sent the header.\n         if self.headers.get(\"Connection\") == \"close\":\n             self.request_handler.close_connection = True\n+\n+    def write(self, data):\n+        \"\"\"Override write to suppress response body for HEAD requests.\"\"\"\n+        if self.environ['REQUEST_METHOD'] == 'HEAD':\n+            # For HEAD requests, don't write the response body\n+            return\n+        super().write(data)\n \n     def close(self):\n         self.get_stdin().read()\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-16502/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16527", "model_patch": "--- a/django/contrib/admin/templatetags/admin_modify.py\n+++ b/django/contrib/admin/templatetags/admin_modify.py\n@@ -100,6 +100,7 @@\n                 and context.get(\"show_delete\", True)\n             ),\n             \"show_save_as_new\": not is_popup\n+            and has_add_permission\n             and has_change_permission\n             and change\n             and save_as,\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16527/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16560", "model_patch": "--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -19,6 +19,7 @@\n class BaseConstraint:\n     default_violation_error_message = _(\"Constraint \u201c%(name)s\u201d is violated.\")\n     violation_error_message = None\n+    default_violation_error_code = \"invalid\"\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n     # def __init__(self, *, name, violation_error_message=None):\n", "leaf_id": 13, "source_tree_path": "tmp/trajectory/django__django-16560/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16569", "model_patch": "--- a/django/forms/formsets.py\n+++ b/django/forms/formsets.py\n@@ -490,7 +490,7 @@\n                     required=False,\n                     widget=self.get_ordering_widget(),\n                 )\n-        if self.can_delete and (self.can_delete_extra or index < initial_form_count):\n+        if self.can_delete and (self.can_delete_extra or (index is not None and index < initial_form_count)):\n             form.fields[DELETION_FIELD_NAME] = BooleanField(\n                 label=_(\"Delete\"),\n                 required=False,\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16569/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16595", "model_patch": "--- a/django/db/migrations/operations/fields.py\n+++ b/django/db/migrations/operations/fields.py\n@@ -251,6 +251,10 @@\n             operation\n         ):\n             return [operation]\n+        elif isinstance(operation, AlterField) and self.is_same_field_operation(\n+            operation\n+        ):\n+            return [operation]\n         elif (\n             isinstance(operation, RenameField)\n             and self.is_same_field_operation(operation)\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-16595/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16612", "model_patch": "--- a/django/contrib/admin/sites.py\n+++ b/django/contrib/admin/sites.py\n@@ -453,7 +453,11 @@\n                 pass\n             else:\n                 if getattr(match.func, \"should_append_slash\", True):\n-                    return HttpResponsePermanentRedirect(\"%s/\" % request.path)\n+                    query_string = request.META.get('QUERY_STRING', '')\n+                    redirect_url = \"%s/\" % request.path\n+                    if query_string:\n+                        redirect_url += \"?%s\" % query_string\n+                    return HttpResponsePermanentRedirect(redirect_url)\n         raise Http404\n \n     def _build_app_dict(self, request, label=None):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16612/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16631", "model_patch": "--- a/django/contrib/auth/base_user.py\n+++ b/django/contrib/auth/base_user.py\n@@ -142,6 +142,40 @@\n             algorithm=\"sha256\",\n         ).hexdigest()\n \n+    def check_session_auth_hash(self, session_auth_hash):\n+        \"\"\"\n+        Check if the given session auth hash is valid for this user.\n+        Try the current SECRET_KEY first, then fallback keys.\n+        \"\"\"\n+        from django.conf import settings\n+        from django.utils.crypto import constant_time_compare\n+        \n+        key_salt = \"django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash\"\n+        \n+        # Try current SECRET_KEY first\n+        current_hash = salted_hmac(\n+            key_salt,\n+            self.password,\n+            algorithm=\"sha256\",\n+        ).hexdigest()\n+        \n+        if constant_time_compare(session_auth_hash, current_hash):\n+            return True\n+            \n+        # Try fallback keys\n+        for fallback_key in getattr(settings, 'SECRET_KEY_FALLBACKS', []):\n+            fallback_hash = salted_hmac(\n+                key_salt,\n+                self.password,\n+                secret=fallback_key,\n+                algorithm=\"sha256\",\n+            ).hexdigest()\n+            \n+            if constant_time_compare(session_auth_hash, fallback_hash):\n+                return True\n+                \n+        return False\n+\n     @classmethod\n     def get_email_field_name(cls):\n         try:\n\n--- a/django/contrib/auth/__init__.py\n+++ b/django/contrib/auth/__init__.py\n@@ -199,9 +199,18 @@\n             # Verify the session\n             if hasattr(user, \"get_session_auth_hash\"):\n                 session_hash = request.session.get(HASH_SESSION_KEY)\n-                session_hash_verified = session_hash and constant_time_compare(\n-                    session_hash, user.get_session_auth_hash()\n-                )\n+                if session_hash:\n+                    # Use check_session_auth_hash to support SECRET_KEY_FALLBACKS\n+                    if hasattr(user, \"check_session_auth_hash\"):\n+                        session_hash_verified = user.check_session_auth_hash(session_hash)\n+                    else:\n+                        # Fallback for custom user models that don't have check_session_auth_hash\n+                        session_hash_verified = constant_time_compare(\n+                            session_hash, user.get_session_auth_hash()\n+                        )\n+                else:\n+                    session_hash_verified = False\n+                    \n                 if not session_hash_verified:\n                     request.session.flush()\n                     user = None\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-16631/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16642", "model_patch": "--- a/django/http/response.py\n+++ b/django/http/response.py\n@@ -612,6 +612,8 @@\n                     \"bzip2\": \"application/x-bzip\",\n                     \"gzip\": \"application/gzip\",\n                     \"xz\": \"application/x-xz\",\n+                    \"compress\": \"application/x-compress\",\n+                    \"br\": \"application/x-brotli\",\n                 }.get(encoding, content_type)\n                 self.headers[\"Content-Type\"] = (\n                     content_type or \"application/octet-stream\"\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16642/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16661", "model_patch": "--- a/tests/modeladmin/tests.py\n+++ b/tests/modeladmin/tests.py\n@@ -123,6 +123,28 @@\n         ma = BandAdmin(Band, self.site)\n         self.assertTrue(ma.lookup_allowed(\"name__nonexistent\", \"test_value\"))\n \n+    @isolate_apps('modeladmin')\n+    def test_lookup_allowed_foreign_primary(self):\n+        class Country(models.Model):\n+            name = models.CharField(max_length=256)\n+        \n+        class Place(models.Model):\n+            country = models.ForeignKey(Country, models.CASCADE)\n+        \n+        class Restaurant(models.Model):\n+            place = models.OneToOneField(Place, models.CASCADE, primary_key=True)\n+        \n+        class Waiter(models.Model):\n+            restaurant = models.ForeignKey(Restaurant, models.CASCADE)\n+        \n+        class WaiterAdmin(ModelAdmin):\n+            list_filter = [\n+                'restaurant__place__country',\n+            ]\n+        \n+        ma = WaiterAdmin(Waiter, self.site)\n+        self.assertIs(ma.lookup_allowed('restaurant__place__country', 'test_value'), True)\n+\n     @isolate_apps(\"modeladmin\")\n     def test_lookup_allowed_onetoone(self):\n         class Department(models.Model):\n", "leaf_id": 14, "source_tree_path": "tmp/trajectory/django__django-16661/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16662", "model_patch": "--- a/django/db/migrations/writer.py\n+++ b/django/db/migrations/writer.py\n@@ -175,7 +175,8 @@\n \n         # Sort imports by the package / module to be imported (the part after\n         # \"from\" in \"from ... import ...\" or after \"import\" in \"import ...\").\n-        sorted_imports = sorted(imports, key=lambda i: i.split()[1])\n+        # Ensure 'import' statements come before 'from' statements.\n+        sorted_imports = sorted(imports, key=lambda i: (0 if i.startswith('import ') else 1, i.split()[1]))\n         items[\"imports\"] = \"\\n\".join(sorted_imports) + \"\\n\" if imports else \"\"\n         if migration_imports:\n             items[\"imports\"] += (\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16662/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16667", "model_patch": "--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -1157,7 +1157,7 @@\n             input_format = formats.sanitize_strftime_format(input_format)\n             try:\n                 date_value = datetime.date(int(y), int(m), int(d))\n-            except ValueError:\n+            except (ValueError, OverflowError):\n                 # Return pseudo-ISO dates with zeros for any unselected values,\n                 # e.g. '2017-0-23'.\n                 return \"%s-%s-%s\" % (y or 0, m or 0, d or 0)\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16667/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16801", "model_patch": "--- a/django/db/models/fields/files.py\n+++ b/django/db/models/fields/files.py\n@@ -441,7 +441,8 @@\n         # after their corresponding image field don't stay cleared by\n         # Model.__init__, see bug #11196.\n         # Only run post-initialization dimension update on non-abstract models\n-        if not cls._meta.abstract:\n+        # and only if dimension fields are actually defined.\n+        if not cls._meta.abstract and (self.width_field or self.height_field):\n             signals.post_init.connect(self.update_dimension_fields, sender=cls)\n \n     def update_dimension_fields(self, instance, force=False, *args, **kwargs):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16801/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16819", "model_patch": "--- a/django/db/migrations/operations/models.py\n+++ b/django/db/migrations/operations/models.py\n@@ -861,6 +861,15 @@\n     def migration_name_fragment(self):\n         return \"%s_%s\" % (self.model_name_lower, self.index.name.lower())\n \n+    def reduce(self, operation, app_label):\n+        if (\n+            isinstance(operation, RemoveIndex)\n+            and self.model_name_lower == operation.model_name_lower\n+            and self.index.name == operation.name\n+        ):\n+            return []\n+        return super().reduce(operation, app_label)\n+\n \n class RemoveIndex(IndexOperation):\n     \"\"\"Remove an index from a model.\"\"\"\n@@ -903,6 +912,15 @@\n     @property\n     def migration_name_fragment(self):\n         return \"remove_%s_%s\" % (self.model_name_lower, self.name.lower())\n+\n+    def reduce(self, operation, app_label):\n+        if (\n+            isinstance(operation, AddIndex)\n+            and self.model_name_lower == operation.model_name_lower\n+            and self.name == operation.index.name\n+        ):\n+            return []\n+        return super().reduce(operation, app_label)\n \n \n class RenameIndex(IndexOperation):\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-16819/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16877", "model_patch": "--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -496,6 +496,16 @@\n     with the results.\n     \"\"\"\n     return [mark_safe(obj) for obj in value]\n+\n+\n+@register.filter(is_safe=True)\n+def escapeseq(value):\n+    \"\"\"\n+    A filter for sequences. Escape each element in the sequence,\n+    individually, after converting them to strings. Return a list\n+    with the results.\n+    \"\"\"\n+    return [escape(obj) for obj in value]\n \n \n @register.filter(is_safe=True)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16877/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16899", "model_patch": "--- a/django/contrib/admin/checks.py\n+++ b/django/contrib/admin/checks.py\n@@ -771,10 +771,11 @@\n             except FieldDoesNotExist:\n                 return [\n                     checks.Error(\n-                        \"The value of '%s' is not a callable, an attribute of \"\n+                        \"The value of '%s' refers to '%s', which is not a callable, an attribute of \"\n                         \"'%s', or an attribute of '%s'.\"\n                         % (\n                             label,\n+                            field_name,\n                             obj.__class__.__name__,\n                             obj.model._meta.label,\n                         ),\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16899/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16901", "model_patch": "--- a/django/db/models/sql/where.py\n+++ b/django/db/models/sql/where.py\n@@ -129,13 +129,13 @@\n             # Convert if the database doesn't support XOR:\n             #   a XOR b XOR c XOR ...\n             # to:\n-            #   (a OR b OR c OR ...) AND (a + b + c + ...) == 1\n+            #   (a OR b OR c OR ...) AND (a + b + c + ...) % 2 == 1\n             lhs = self.__class__(self.children, OR)\n             rhs_sum = reduce(\n                 operator.add,\n                 (Case(When(c, then=1), default=0) for c in self.children),\n             )\n-            rhs = Exact(1, rhs_sum)\n+            rhs = Exact(1, rhs_sum % 2)\n             return self.__class__([lhs, rhs], AND, self.negated).as_sql(\n                 compiler, connection\n             )\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-16901/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16938", "model_patch": "--- a/django/core/serializers/python.py\n+++ b/django/core/serializers/python.py\n@@ -79,7 +79,7 @@\n                     return self._value_from_field(value, value._meta.pk)\n \n                 def queryset_iterator(obj, field):\n-                    return getattr(obj, field.name).only(\"pk\").iterator()\n+                    return getattr(obj, field.name).select_related(None).only(\"pk\").iterator()\n \n             m2m_iter = getattr(obj, \"_prefetched_objects_cache\", {}).get(\n                 field.name,\n", "leaf_id": 10, "source_tree_path": "tmp/trajectory/django__django-16938/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16950", "model_patch": "--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -1135,6 +1135,19 @@\n         if self.fk.remote_field.field_name != self.fk.remote_field.model._meta.pk.name:\n             fk_value = getattr(self.instance, self.fk.remote_field.field_name)\n             fk_value = getattr(fk_value, \"pk\", fk_value)\n+        \n+        # If fk_value is None and the target field has a default, apply the default\n+        if fk_value is None:\n+            target_field = self.fk.remote_field.model._meta.get_field(self.fk.remote_field.field_name)\n+            if hasattr(target_field, 'default') and target_field.default is not None:\n+                # Apply the default value to the parent instance\n+                if callable(target_field.default):\n+                    default_value = target_field.default()\n+                else:\n+                    default_value = target_field.default\n+                setattr(self.instance, self.fk.remote_field.field_name, default_value)\n+                fk_value = default_value\n+        \n         setattr(form.instance, self.fk.get_attname(), fk_value)\n         return form\n \n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-16950/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-17029", "model_patch": "--- a/django/apps/registry.py\n+++ b/django/apps/registry.py\n@@ -376,6 +376,7 @@\n         # Call expire cache on each model. This will purge\n         # the relation tree and the fields cache.\n         self.get_models.cache_clear()\n+        self.get_swappable_settings_name.cache_clear()\n         if self.ready:\n             # Circumvent self.get_models() to prevent that the cache is refilled.\n             # This particularly prevents that an empty value is cached while cloning.\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-17029/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-17084", "model_patch": "--- a/django/db/models/aggregates.py\n+++ b/django/db/models/aggregates.py\n@@ -88,6 +88,19 @@\n                         \"Cannot compute %s('%s'): '%s' is an aggregate\"\n                         % (c.name, name, name)\n                     )\n+            # Check for window functions in source expressions\n+            for index, expr in enumerate(expressions):\n+                if expr.contains_over_clause:\n+                    before_resolved = self.get_source_expressions()[index]\n+                    name = (\n+                        before_resolved.name\n+                        if hasattr(before_resolved, \"name\")\n+                        else repr(before_resolved)\n+                    )\n+                    raise FieldError(\n+                        \"Cannot compute %s('%s'): '%s' contains a window function\"\n+                        % (c.name, name, name)\n+                    )\n         if (default := c.default) is None:\n             return c\n         if hasattr(default, \"resolve_expression\"):\n", "leaf_id": 10, "source_tree_path": "tmp/trajectory/django__django-17084/2025-11-18_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-17087", "model_patch": "--- a/django/db/migrations/serializer.py\n+++ b/django/db/migrations/serializer.py\n@@ -168,7 +168,7 @@\n         ):\n             klass = self.value.__self__\n             module = klass.__module__\n-            return \"%s.%s.%s\" % (module, klass.__name__, self.value.__name__), {\n+            return \"%s.%s.%s\" % (module, klass.__qualname__, self.value.__name__), {\n                 \"import %s\" % module\n             }\n         # Further error checking\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-17087/2025-11-18_trajectory.json"}
