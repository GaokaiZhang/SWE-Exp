{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16255", "model_patch": "--- a/django/contrib/sitemaps/__init__.py\n+++ b/django/contrib/sitemaps/__init__.py\n@@ -168,7 +168,7 @@\n         if callable(self.lastmod):\n             try:\n                 return max([self.lastmod(item) for item in self.items()])\n-            except TypeError:\n+            except (TypeError, ValueError):\n                 return None\n         else:\n             return self.lastmod\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16255/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16256", "model_patch": "--- a/django/db/models/fields/related_descriptors.py\n+++ b/django/db/models/fields/related_descriptors.py\n@@ -793,6 +793,11 @@\n \n         create.alters_data = True\n \n+        async def acreate(self, **kwargs):\n+            return await sync_to_async(self.create)(**kwargs)\n+\n+        acreate.alters_data = True\n+\n         def get_or_create(self, **kwargs):\n             self._check_fk_val()\n             kwargs[self.field.name] = self.instance\n@@ -801,6 +806,11 @@\n \n         get_or_create.alters_data = True\n \n+        async def aget_or_create(self, **kwargs):\n+            return await sync_to_async(self.get_or_create)(**kwargs)\n+\n+        aget_or_create.alters_data = True\n+\n         def update_or_create(self, **kwargs):\n             self._check_fk_val()\n             kwargs[self.field.name] = self.instance\n@@ -808,6 +818,11 @@\n             return super(RelatedManager, self.db_manager(db)).update_or_create(**kwargs)\n \n         update_or_create.alters_data = True\n+\n+        async def aupdate_or_create(self, **kwargs):\n+            return await sync_to_async(self.update_or_create)(**kwargs)\n+\n+        aupdate_or_create.alters_data = True\n \n         # remove() and clear() are only provided if the ForeignKey can have a\n         # value of null.\n@@ -1191,6 +1206,11 @@\n \n         create.alters_data = True\n \n+        async def acreate(self, *, through_defaults=None, **kwargs):\n+            return await sync_to_async(self.create)(through_defaults=through_defaults, **kwargs)\n+\n+        acreate.alters_data = True\n+\n         def get_or_create(self, *, through_defaults=None, **kwargs):\n             db = router.db_for_write(self.instance.__class__, instance=self.instance)\n             obj, created = super(ManyRelatedManager, self.db_manager(db)).get_or_create(\n@@ -1203,6 +1223,11 @@\n             return obj, created\n \n         get_or_create.alters_data = True\n+\n+        async def aget_or_create(self, *, through_defaults=None, **kwargs):\n+            return await sync_to_async(self.get_or_create)(through_defaults=through_defaults, **kwargs)\n+\n+        aget_or_create.alters_data = True\n \n         def update_or_create(self, *, through_defaults=None, **kwargs):\n             db = router.db_for_write(self.instance.__class__, instance=self.instance)\n@@ -1216,6 +1241,11 @@\n             return obj, created\n \n         update_or_create.alters_data = True\n+\n+        async def aupdate_or_create(self, *, through_defaults=None, **kwargs):\n+            return await sync_to_async(self.update_or_create)(through_defaults=through_defaults, **kwargs)\n+\n+        aupdate_or_create.alters_data = True\n \n         def _get_target_ids(self, target_field_name, objs):\n             \"\"\"\n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-16256/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16263", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -550,6 +550,73 @@\n         Perform a COUNT() query using the current filter constraints.\n         \"\"\"\n         obj = self.clone()\n+        \n+        # Strip unused annotations to optimize the count query\n+        if obj.annotations:\n+            used_annotations = set()\n+            \n+            # Check annotations referenced by where clause\n+            def collect_annotation_refs(node):\n+                if hasattr(node, 'children'):\n+                    for child in node.children:\n+                        collect_annotation_refs(child)\n+                elif hasattr(node, 'lhs'):\n+                    # For lookups, check if lhs references annotations\n+                    if hasattr(node.lhs, 'target') and hasattr(node.lhs.target, 'name'):\n+                        lookup_parts = node.lhs.target.name.split(LOOKUP_SEP)\n+                        annotation_ref, _ = refs_expression(lookup_parts, obj.annotations)\n+                        if annotation_ref:\n+                            used_annotations.add(lookup_parts[0])\n+                    # Also check rhs for F expressions that might reference annotations\n+                    if hasattr(node, 'rhs') and hasattr(node.rhs, 'name'):\n+                        lookup_parts = node.rhs.name.split(LOOKUP_SEP)\n+                        annotation_ref, _ = refs_expression(lookup_parts, obj.annotations)\n+                        if annotation_ref:\n+                            used_annotations.add(lookup_parts[0])\n+            \n+            collect_annotation_refs(obj.where)\n+            \n+            # Check annotations referenced by order_by\n+            for order_field in obj.order_by:\n+                if hasattr(order_field, 'expression') and hasattr(order_field.expression, 'name'):\n+                    # Handle OrderBy expressions\n+                    field_name = order_field.expression.name\n+                    if field_name in obj.annotations:\n+                        used_annotations.add(field_name)\n+                elif isinstance(order_field, str):\n+                    # Handle string-based ordering\n+                    field_name = order_field.lstrip('-')\n+                    if field_name in obj.annotations:\n+                        used_annotations.add(field_name)\n+            \n+            # Check for annotations that depend on other annotations\n+            def find_dependent_annotations(annotation_name, annotation_expr):\n+                dependent_annotations = set()\n+                if hasattr(annotation_expr, 'get_source_expressions'):\n+                    for expr in annotation_expr.get_source_expressions():\n+                        if hasattr(expr, 'name') and expr.name in obj.annotations:\n+                            dependent_annotations.add(expr.name)\n+                            # Recursively find dependencies\n+                            dependent_annotations.update(\n+                                find_dependent_annotations(expr.name, obj.annotations[expr.name])\n+                            )\n+                return dependent_annotations\n+            \n+            # Add dependencies of used annotations\n+            annotations_to_check = list(used_annotations)\n+            for annotation_name in annotations_to_check:\n+                if annotation_name in obj.annotations:\n+                    dependencies = find_dependent_annotations(annotation_name, obj.annotations[annotation_name])\n+                    used_annotations.update(dependencies)\n+            \n+            # Remove unused annotations\n+            annotations_to_remove = set(obj.annotations.keys()) - used_annotations\n+            for annotation_name in annotations_to_remove:\n+                del obj.annotations[annotation_name]\n+                # Also remove from annotation_select_mask if it exists\n+                if obj.annotation_select_mask and annotation_name in obj.annotation_select_mask:\n+                    obj.annotation_select_mask = [name for name in obj.annotation_select_mask if name != annotation_name]\n+        \n         obj.add_annotation(Count(\"*\"), alias=\"__count\", is_summary=True)\n         return obj.get_aggregation(using, [\"__count\"])[\"__count\"]\n \n", "leaf_id": 17, "source_tree_path": "tmp/trajectory/django__django-16263/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16315", "model_patch": "--- a/django/db/backends/postgresql/operations.py\n+++ b/django/db/backends/postgresql/operations.py\n@@ -353,12 +353,25 @@\n         if on_conflict == OnConflict.IGNORE:\n             return \"ON CONFLICT DO NOTHING\"\n         if on_conflict == OnConflict.UPDATE:\n+            # Create mapping from field names to database column names\n+            field_name_to_db_column = {field.name: field.column for field in fields}\n+            \n+            # Convert field names to database column names\n+            unique_db_columns = [\n+                field_name_to_db_column.get(field_name, field_name) \n+                for field_name in unique_fields\n+            ]\n+            update_db_columns = [\n+                field_name_to_db_column.get(field_name, field_name) \n+                for field_name in update_fields\n+            ]\n+            \n             return \"ON CONFLICT(%s) DO UPDATE SET %s\" % (\n-                \", \".join(map(self.quote_name, unique_fields)),\n+                \", \".join(map(self.quote_name, unique_db_columns)),\n                 \", \".join(\n                     [\n                         f\"{field} = EXCLUDED.{field}\"\n-                        for field in map(self.quote_name, update_fields)\n+                        for field in map(self.quote_name, update_db_columns)\n                     ]\n                 ),\n             )\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16315/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16333", "model_patch": "--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -141,6 +141,9 @@\n         user.set_password(self.cleaned_data[\"password1\"])\n         if commit:\n             user.save()\n+            self._save_m2m()\n+        else:\n+            self.save_m2m = self._save_m2m\n         return user\n \n \n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16333/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16429", "model_patch": "--- a/django/utils/timesince.py\n+++ b/django/utils/timesince.py\n@@ -97,6 +97,8 @@\n             d.hour,\n             d.minute,\n             d.second,\n+            0,\n+            d.tzinfo,\n         )\n     else:\n         pivot = d\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16429/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16454", "model_patch": "--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -70,6 +70,24 @@\n             super().error(message)\n         else:\n             raise CommandError(\"Error: %s\" % message)\n+\n+    def add_subparsers(self, **kwargs):\n+        if 'parser_class' not in kwargs:\n+            kwargs['parser_class'] = type(self)\n+        subparsers_action = super().add_subparsers(**kwargs)\n+        # Store the parent's parameters to pass to subparsers\n+        subparsers_action._missing_args_message = self.missing_args_message\n+        subparsers_action._called_from_command_line = self.called_from_command_line\n+        # Override the add_parser method to pass parent's parameters\n+        original_add_parser = subparsers_action.add_parser\n+        def add_parser_with_inheritance(*args, **parser_kwargs):\n+            if 'missing_args_message' not in parser_kwargs:\n+                parser_kwargs['missing_args_message'] = subparsers_action._missing_args_message\n+            if 'called_from_command_line' not in parser_kwargs:\n+                parser_kwargs['called_from_command_line'] = subparsers_action._called_from_command_line\n+            return original_add_parser(*args, **parser_kwargs)\n+        subparsers_action.add_parser = add_parser_with_inheritance\n+        return subparsers_action\n \n \n def handle_default_options(options):\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-16454/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16485", "model_patch": "--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -184,6 +184,7 @@\n     units = len(tupl[1])\n     units += -tupl[2] if m else tupl[2]\n     prec = abs(p) + units + 1\n+    prec = max(1, prec)\n \n     # Avoid conversion to scientific notation by accessing `sign`, `digits`,\n     # and `exponent` from Decimal.as_tuple() directly.\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-16485/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16493", "model_patch": "--- a/django/db/models/fields/files.py\n+++ b/django/db/models/fields/files.py\n@@ -295,7 +295,7 @@\n         if kwargs.get(\"max_length\") == 100:\n             del kwargs[\"max_length\"]\n         kwargs[\"upload_to\"] = self.upload_to\n-        if self.storage is not default_storage:\n+        if hasattr(self, \"_storage_callable\") or self.storage is not default_storage:\n             kwargs[\"storage\"] = getattr(self, \"_storage_callable\", self.storage)\n         return name, path, args, kwargs\n \n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16493/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16502", "model_patch": "--- a/django/core/servers/basehttp.py\n+++ b/django/core/servers/basehttp.py\n@@ -142,6 +142,25 @@\n         # application sent the header.\n         if self.headers.get(\"Connection\") == \"close\":\n             self.request_handler.close_connection = True\n+\n+    def write(self, data):\n+        \"\"\"Override write() to strip response bodies for HEAD requests.\"\"\"\n+        assert isinstance(data, bytes), \"write() argument must be bytestring\"\n+        \n+        if not self.status:\n+            raise AssertionError(\"write() before start_response()\")\n+        \n+        # For HEAD requests, only send headers, not the response body\n+        if self.environ.get('REQUEST_METHOD') == 'HEAD':\n+            if not self.headers_sent:\n+                # Send headers for HEAD requests but no body\n+                self.bytes_sent = len(data)  # Track content length for headers\n+                self.send_headers()\n+            # Don't write any body data for HEAD requests\n+            return\n+        \n+        # For non-HEAD requests, use the parent implementation\n+        super().write(data)\n \n     def close(self):\n         self.get_stdin().read()\n", "leaf_id": 14, "source_tree_path": "tmp/trajectory/django__django-16502/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16527", "model_patch": "--- a/django/contrib/admin/templatetags/admin_modify.py\n+++ b/django/contrib/admin/templatetags/admin_modify.py\n@@ -100,6 +100,7 @@\n                 and context.get(\"show_delete\", True)\n             ),\n             \"show_save_as_new\": not is_popup\n+            and has_add_permission\n             and has_change_permission\n             and change\n             and save_as,\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16527/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16560", "model_patch": "--- a/django/db/models/constraints.py\n+++ b/django/db/models/constraints.py\n@@ -21,8 +21,8 @@\n     violation_error_message = None\n \n     # RemovedInDjango60Warning: When the deprecation ends, replace with:\n-    # def __init__(self, *, name, violation_error_message=None):\n-    def __init__(self, *args, name=None, violation_error_message=None):\n+    # def __init__(self, *, name, violation_error_message=None, violation_error_code=None):\n+    def __init__(self, *args, name=None, violation_error_message=None, violation_error_code=None):\n         # RemovedInDjango60Warning.\n         if name is None and not args:\n             raise TypeError(\n", "leaf_id": 19, "source_tree_path": "tmp/trajectory/django__django-16560/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16569", "model_patch": "--- a/django/forms/formsets.py\n+++ b/django/forms/formsets.py\n@@ -490,7 +490,7 @@\n                     required=False,\n                     widget=self.get_ordering_widget(),\n                 )\n-        if self.can_delete and (self.can_delete_extra or index < initial_form_count):\n+        if self.can_delete and (self.can_delete_extra or (index is not None and index < initial_form_count)):\n             form.fields[DELETION_FIELD_NAME] = BooleanField(\n                 label=_(\"Delete\"),\n                 required=False,\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16569/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16595", "model_patch": "--- a/django/db/migrations/operations/fields.py\n+++ b/django/db/migrations/operations/fields.py\n@@ -247,7 +247,11 @@\n         return \"alter_%s_%s\" % (self.model_name_lower, self.name_lower)\n \n     def reduce(self, operation, app_label):\n-        if isinstance(operation, RemoveField) and self.is_same_field_operation(\n+        if isinstance(operation, AlterField) and self.is_same_field_operation(\n+            operation\n+        ):\n+            return [operation]\n+        elif isinstance(operation, RemoveField) and self.is_same_field_operation(\n             operation\n         ):\n             return [operation]\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-16595/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16612", "model_patch": "--- a/django/contrib/admin/sites.py\n+++ b/django/contrib/admin/sites.py\n@@ -453,7 +453,11 @@\n                 pass\n             else:\n                 if getattr(match.func, \"should_append_slash\", True):\n-                    return HttpResponsePermanentRedirect(\"%s/\" % request.path)\n+                    query_string = request.META.get('QUERY_STRING', '')\n+                    redirect_url = \"%s/\" % request.path\n+                    if query_string:\n+                        redirect_url += \"?%s\" % query_string\n+                    return HttpResponsePermanentRedirect(redirect_url)\n         raise Http404\n \n     def _build_app_dict(self, request, label=None):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16612/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16631", "model_patch": "--- a/django/contrib/auth/__init__.py\n+++ b/django/contrib/auth/__init__.py\n@@ -5,7 +5,7 @@\n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured, PermissionDenied\n from django.middleware.csrf import rotate_token\n-from django.utils.crypto import constant_time_compare\n+from django.utils.crypto import constant_time_compare, salted_hmac\n from django.utils.module_loading import import_string\n from django.views.decorators.debug import sensitive_variables\n \n@@ -15,6 +15,44 @@\n BACKEND_SESSION_KEY = \"_auth_user_backend\"\n HASH_SESSION_KEY = \"_auth_user_hash\"\n REDIRECT_FIELD_NAME = \"next\"\n+\n+\n+def _validate_session_auth_hash(stored_hash, user):\n+    \"\"\"\n+    Validate a session auth hash against both the current SECRET_KEY and\n+    SECRET_KEY_FALLBACKS. This allows for proper secret key rotation without\n+    logging out all users.\n+    \"\"\"\n+    if not stored_hash or not hasattr(user, 'get_session_auth_hash'):\n+        return False\n+    \n+    # Get the key salt used by get_session_auth_hash\n+    key_salt = \"django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash\"\n+    \n+    # Try with current SECRET_KEY first\n+    current_hash = salted_hmac(\n+        key_salt,\n+        user.password,\n+        algorithm=\"sha256\",\n+    ).hexdigest()\n+    \n+    if constant_time_compare(stored_hash, current_hash):\n+        return True\n+    \n+    # Try with fallback keys\n+    fallback_keys = getattr(settings, 'SECRET_KEY_FALLBACKS', [])\n+    for fallback_key in fallback_keys:\n+        fallback_hash = salted_hmac(\n+            key_salt,\n+            user.password,\n+            secret=fallback_key,\n+            algorithm=\"sha256\",\n+        ).hexdigest()\n+        \n+        if constant_time_compare(stored_hash, fallback_hash):\n+            return True\n+    \n+    return False\n \n \n def load_backend(path):\n@@ -199,10 +237,7 @@\n             # Verify the session\n             if hasattr(user, \"get_session_auth_hash\"):\n                 session_hash = request.session.get(HASH_SESSION_KEY)\n-                session_hash_verified = session_hash and constant_time_compare(\n-                    session_hash, user.get_session_auth_hash()\n-                )\n-                if not session_hash_verified:\n+                if not _validate_session_auth_hash(session_hash, user):\n                     request.session.flush()\n                     user = None\n \n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-16631/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16642", "model_patch": "--- a/django/http/response.py\n+++ b/django/http/response.py\n@@ -612,6 +612,8 @@\n                     \"bzip2\": \"application/x-bzip\",\n                     \"gzip\": \"application/gzip\",\n                     \"xz\": \"application/x-xz\",\n+                    \"compress\": \"application/x-compress\",\n+                    \"br\": \"application/x-brotli\",\n                 }.get(encoding, content_type)\n                 self.headers[\"Content-Type\"] = (\n                     content_type or \"application/octet-stream\"\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16642/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16662", "model_patch": "--- a/django/db/migrations/writer.py\n+++ b/django/db/migrations/writer.py\n@@ -175,7 +175,22 @@\n \n         # Sort imports by the package / module to be imported (the part after\n         # \"from\" in \"from ... import ...\" or after \"import\" in \"import ...\").\n-        sorted_imports = sorted(imports, key=lambda i: i.split()[1])\n+        # Separate 'import' statements from 'from...import' statements and place\n+        # all 'import' statements before 'from...import' statements.\n+        import_statements = []\n+        from_import_statements = []\n+        for imp in imports:\n+            if imp.startswith('import '):\n+                import_statements.append(imp)\n+            else:\n+                from_import_statements.append(imp)\n+        \n+        # Sort each group alphabetically by module name\n+        import_statements.sort(key=lambda i: i.split()[1])\n+        from_import_statements.sort(key=lambda i: i.split()[1])\n+        \n+        # Combine with import statements first\n+        sorted_imports = import_statements + from_import_statements\n         items[\"imports\"] = \"\\n\".join(sorted_imports) + \"\\n\" if imports else \"\"\n         if migration_imports:\n             items[\"imports\"] += (\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16662/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16667", "model_patch": "--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -1157,7 +1157,7 @@\n             input_format = formats.sanitize_strftime_format(input_format)\n             try:\n                 date_value = datetime.date(int(y), int(m), int(d))\n-            except ValueError:\n+            except (ValueError, OverflowError):\n                 # Return pseudo-ISO dates with zeros for any unselected values,\n                 # e.g. '2017-0-23'.\n                 return \"%s-%s-%s\" % (y or 0, m or 0, d or 0)\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16667/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16801", "model_patch": "--- a/django/db/models/fields/files.py\n+++ b/django/db/models/fields/files.py\n@@ -441,7 +441,8 @@\n         # after their corresponding image field don't stay cleared by\n         # Model.__init__, see bug #11196.\n         # Only run post-initialization dimension update on non-abstract models\n-        if not cls._meta.abstract:\n+        # and only if width_field or height_field is set\n+        if not cls._meta.abstract and (self.width_field or self.height_field):\n             signals.post_init.connect(self.update_dimension_fields, sender=cls)\n \n     def update_dimension_fields(self, instance, force=False, *args, **kwargs):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16801/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16819", "model_patch": "--- a/django/db/migrations/operations/models.py\n+++ b/django/db/migrations/operations/models.py\n@@ -820,6 +820,15 @@\n             )\n         self.index = index\n \n+    def reduce(self, operation, app_label):\n+        if (\n+            isinstance(operation, RemoveIndex)\n+            and self.model_name_lower == operation.model_name_lower\n+            and self.index.name == operation.name\n+        ):\n+            return []\n+        return super().reduce(operation, app_label)\n+\n     def state_forwards(self, app_label, state):\n         state.add_index(app_label, self.model_name_lower, self.index)\n \n@@ -868,6 +877,15 @@\n     def __init__(self, model_name, name):\n         self.model_name = model_name\n         self.name = name\n+\n+    def reduce(self, operation, app_label):\n+        if (\n+            isinstance(operation, AddIndex)\n+            and self.model_name_lower == operation.model_name_lower\n+            and self.name == operation.index.name\n+        ):\n+            return []\n+        return super().reduce(operation, app_label)\n \n     def state_forwards(self, app_label, state):\n         state.remove_index(app_label, self.model_name_lower, self.name)\n", "leaf_id": 10, "source_tree_path": "tmp/trajectory/django__django-16819/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16877", "model_patch": "--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -496,6 +496,16 @@\n     with the results.\n     \"\"\"\n     return [mark_safe(obj) for obj in value]\n+\n+\n+@register.filter(is_safe=True)\n+def escapeseq(value):\n+    \"\"\"\n+    A filter for sequences. Escape each element in the sequence,\n+    individually, after converting them to strings. Return a list\n+    with the results.\n+    \"\"\"\n+    return [escape(obj) for obj in value]\n \n \n @register.filter(is_safe=True)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16877/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16899", "model_patch": "--- a/django/contrib/admin/checks.py\n+++ b/django/contrib/admin/checks.py\n@@ -771,10 +771,11 @@\n             except FieldDoesNotExist:\n                 return [\n                     checks.Error(\n-                        \"The value of '%s' is not a callable, an attribute of \"\n+                        \"The value of '%s' refers to '%s', which is not a callable, an attribute of \"\n                         \"'%s', or an attribute of '%s'.\"\n                         % (\n                             label,\n+                            field_name,\n                             obj.__class__.__name__,\n                             obj.model._meta.label,\n                         ),\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16899/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16901", "model_patch": "--- a/django/db/models/sql/where.py\n+++ b/django/db/models/sql/where.py\n@@ -129,13 +129,14 @@\n             # Convert if the database doesn't support XOR:\n             #   a XOR b XOR c XOR ...\n             # to:\n-            #   (a OR b OR c OR ...) AND (a + b + c + ...) == 1\n+            #   (a OR b OR c OR ...) AND (a + b + c + ...) % 2 == 1\n+            from django.db.models.expressions import Mod\n             lhs = self.__class__(self.children, OR)\n             rhs_sum = reduce(\n                 operator.add,\n                 (Case(When(c, then=1), default=0) for c in self.children),\n             )\n-            rhs = Exact(1, rhs_sum)\n+            rhs = Exact(1, Mod(rhs_sum, 2))\n             return self.__class__([lhs, rhs], AND, self.negated).as_sql(\n                 compiler, connection\n             )\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16901/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16938", "model_patch": "--- a/django/db/models/fields/related_descriptors.py\n+++ b/django/db/models/fields/related_descriptors.py\n@@ -962,7 +962,7 @@\n         related_model = self.rel.related_model if self.reverse else self.rel.model\n \n         return create_forward_many_to_many_manager(\n-            related_model._default_manager.__class__,\n+            related_model._base_manager.__class__,\n             self.rel,\n             reverse=self.reverse,\n         )\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-16938/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16950", "model_patch": "--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -1177,7 +1177,9 @@\n                 to_field = self.instance._meta.get_field(kwargs[\"to_field\"])\n             else:\n                 to_field = self.instance._meta.pk\n-            if to_field.has_default():\n+            # Only set to None for auto-incrementing fields, not fields that rely on their defaults\n+            from django.db import models\n+            if isinstance(to_field, (models.AutoField, models.BigAutoField, models.SmallAutoField)):\n                 setattr(self.instance, to_field.attname, None)\n \n         form.fields[name] = InlineForeignKeyField(self.instance, **kwargs)\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-16950/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-17029", "model_patch": "--- a/django/apps/registry.py\n+++ b/django/apps/registry.py\n@@ -376,6 +376,7 @@\n         # Call expire cache on each model. This will purge\n         # the relation tree and the fields cache.\n         self.get_models.cache_clear()\n+        self.get_swappable_settings_name.cache_clear()\n         if self.ready:\n             # Circumvent self.get_models() to prevent that the cache is refilled.\n             # This particularly prevents that an empty value is cached while cloning.\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-17029/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-17084", "model_patch": "--- a/django/db/models/aggregates.py\n+++ b/django/db/models/aggregates.py\n@@ -88,6 +88,17 @@\n                         \"Cannot compute %s('%s'): '%s' is an aggregate\"\n                         % (c.name, name, name)\n                     )\n+                if expr.contains_over_clause:\n+                    before_resolved = self.get_source_expressions()[index]\n+                    name = (\n+                        before_resolved.name\n+                        if hasattr(before_resolved, \"name\")\n+                        else repr(before_resolved)\n+                    )\n+                    raise FieldError(\n+                        \"Cannot compute %s('%s'): '%s' contains a window function\"\n+                        % (c.name, name, name)\n+                    )\n         if (default := c.default) is None:\n             return c\n         if hasattr(default, \"resolve_expression\"):\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-17084/2025-11-24_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-17087", "model_patch": "--- a/django/db/migrations/serializer.py\n+++ b/django/db/migrations/serializer.py\n@@ -168,7 +168,7 @@\n         ):\n             klass = self.value.__self__\n             module = klass.__module__\n-            return \"%s.%s.%s\" % (module, klass.__name__, self.value.__name__), {\n+            return \"%s.%s.%s\" % (module, klass.__qualname__, self.value.__name__), {\n                 \"import %s\" % module\n             }\n         # Further error checking\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-17087/2025-11-24_trajectory.json"}
