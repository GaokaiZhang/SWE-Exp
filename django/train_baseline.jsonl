{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-7530", "model_patch": "--- a/django/core/management/commands/makemigrations.py\n+++ b/django/core/management/commands/makemigrations.py\n@@ -105,7 +105,7 @@\n                     # At least one model must be migrated to the database.\n                     router.allow_migrate(connection.alias, app_label, model_name=model._meta.object_name)\n                     for app_label in consistency_check_labels\n-                    for model in apps.get_models(app_label)\n+                    for model in apps.get_app_config(app_label).get_models()\n             )):\n                 loader.check_consistent_history(connection)\n \n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-7530/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-9296", "model_patch": "--- a/django/core/paginator.py\n+++ b/django/core/paginator.py\n@@ -106,6 +106,10 @@\n         \"\"\"\n         return range(1, self.num_pages + 1)\n \n+    def __iter__(self):\n+        for page_num in self.page_range:\n+            yield self.page(page_num)\n+\n     def _check_object_list_is_ordered(self):\n         \"\"\"\n         Warn if self.object_list is unordered (typically a QuerySet).\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-9296/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-10097", "model_patch": "--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -94,7 +94,7 @@\n \n     regex = _lazy_re_compile(\n         r'^(?:[a-z0-9\\.\\-\\+]*)://'  # scheme is validated separately\n-        r'(?:\\S+(?::\\S*)?@)?'  # user:pass authentication\n+        r'(?:(?:[^\\s:@/]|%[0-9A-Fa-f]{2})+(?::(?:[^\\s:@/]|%[0-9A-Fa-f]{2})*)?@)?'  # user:pass authentication\n         r'(?:' + ipv4_re + '|' + ipv6_re + '|' + host_re + ')'\n         r'(?::\\d{2,5})?'  # port\n         r'(?:[/?#][^\\s]*)?'  # resource path\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-10097/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-10880", "model_patch": "--- a/django/db/models/aggregates.py\n+++ b/django/db/models/aggregates.py\n@@ -68,7 +68,7 @@\n         return []\n \n     def as_sql(self, compiler, connection, **extra_context):\n-        extra_context['distinct'] = 'DISTINCT' if self.distinct else ''\n+        extra_context['distinct'] = 'DISTINCT ' if self.distinct else ''\n         if self.filter:\n             if connection.features.supports_aggregate_filter_clause:\n                 filter_sql, filter_params = self.filter.as_sql(compiler, connection)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-10880/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-10914", "model_patch": "--- a/django/conf/global_settings.py\n+++ b/django/conf/global_settings.py\n@@ -304,7 +304,7 @@\n \n # The numeric mode to set newly-uploaded files to. The value should be a mode\n # you'd pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n-FILE_UPLOAD_PERMISSIONS = None\n+FILE_UPLOAD_PERMISSIONS = 0o644\n \n # The numeric mode to assign to newly-created directories, when uploading files.\n # The value should be a mode as you'd pass to os.chmod;\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-10914/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-10973", "model_patch": "--- a/django/db/backends/postgresql/client.py\n+++ b/django/db/backends/postgresql/client.py\n@@ -34,38 +34,18 @@\n             args += ['-p', str(port)]\n         args += [dbname]\n \n-        temp_pgpass = None\n+        env = os.environ.copy()\n+        if passwd:\n+            env['PGPASSWORD'] = passwd\n+        \n         sigint_handler = signal.getsignal(signal.SIGINT)\n         try:\n-            if passwd:\n-                # Create temporary .pgpass file.\n-                temp_pgpass = NamedTemporaryFile(mode='w+')\n-                try:\n-                    print(\n-                        _escape_pgpass(host) or '*',\n-                        str(port) or '*',\n-                        _escape_pgpass(dbname) or '*',\n-                        _escape_pgpass(user) or '*',\n-                        _escape_pgpass(passwd),\n-                        file=temp_pgpass,\n-                        sep=':',\n-                        flush=True,\n-                    )\n-                    os.environ['PGPASSFILE'] = temp_pgpass.name\n-                except UnicodeEncodeError:\n-                    # If the current locale can't encode the data, let the\n-                    # user input the password manually.\n-                    pass\n             # Allow SIGINT to pass to psql to abort queries.\n             signal.signal(signal.SIGINT, signal.SIG_IGN)\n-            subprocess.check_call(args)\n+            subprocess.run(args, env=env, check=True)\n         finally:\n             # Restore the original SIGINT handler.\n             signal.signal(signal.SIGINT, sigint_handler)\n-            if temp_pgpass:\n-                temp_pgpass.close()\n-                if 'PGPASSFILE' in os.environ:  # unit tests need cleanup\n-                    del os.environ['PGPASSFILE']\n \n     def runshell(self):\n         DatabaseClient.runshell_db(self.connection.get_connection_params())\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-10973/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-10999", "model_patch": "--- a/django/utils/dateparse.py\n+++ b/django/utils/dateparse.py\n@@ -29,7 +29,7 @@\n standard_duration_re = re.compile(\n     r'^'\n     r'(?:(?P<days>-?\\d+) (days?, )?)?'\n-    r'((?:(?P<hours>-?\\d+):)(?=\\d+:\\d+))?'\n+    r'((?:(?P<hours>-?\\d+):)(?=-?\\d+:-?\\d+))?'\n     r'(?:(?P<minutes>-?\\d+):)?'\n     r'(?P<seconds>-?\\d+)'\n     r'(?:\\.(?P<microseconds>\\d{1,6})\\d{0,6})?'\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-10999/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11095", "model_patch": "--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -580,9 +580,18 @@\n     def __str__(self):\n         return \"%s.%s\" % (self.model._meta.app_label, self.__class__.__name__)\n \n+    def get_inlines(self, request, obj=None):\n+        \"\"\"\n+        Hook for specifying the inlines to use.\n+        \n+        By default, returns self.inlines. Can be overridden to dynamically\n+        determine which inlines to use based on the request or model instance.\n+        \"\"\"\n+        return self.inlines\n+\n     def get_inline_instances(self, request, obj=None):\n         inline_instances = []\n-        for inline_class in self.inlines:\n+        for inline_class in self.get_inlines(request, obj):\n             inline = inline_class(self.model, self.admin_site)\n             if request:\n                 if not (inline.has_view_or_change_permission(request, obj) or\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11095/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11099", "model_patch": "--- a/django/contrib/auth/validators.py\n+++ b/django/contrib/auth/validators.py\n@@ -7,7 +7,7 @@\n \n @deconstructible\n class ASCIIUsernameValidator(validators.RegexValidator):\n-    regex = r'^[\\w.@+-]+$'\n+    regex = r'\\A[\\w.@+-]+\\Z'\n     message = _(\n         'Enter a valid username. This value may contain only English letters, '\n         'numbers, and @/./+/-/_ characters.'\n@@ -17,7 +17,7 @@\n \n @deconstructible\n class UnicodeUsernameValidator(validators.RegexValidator):\n-    regex = r'^[\\w.@+-]+$'\n+    regex = r'\\A[\\w.@+-]+\\Z'\n     message = _(\n         'Enter a valid username. This value may contain only letters, '\n         'numbers, and @/./+/-/_ characters.'\n", "leaf_id": 11, "source_tree_path": "tmp/trajectory/django__django-11099/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11119", "model_patch": "--- a/django/template/engine.py\n+++ b/django/template/engine.py\n@@ -160,7 +160,7 @@\n         if isinstance(context, Context):\n             return t.render(context)\n         else:\n-            return t.render(Context(context))\n+            return t.render(Context(context, autoescape=self.autoescape))\n \n     def select_template(self, template_name_list):\n         \"\"\"\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-11119/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11133", "model_patch": "--- a/django/http/response.py\n+++ b/django/http/response.py\n@@ -226,6 +226,9 @@\n         # an instance of a subclass, this function returns `bytes(value)`.\n         # This doesn't make a copy when `value` already contains bytes.\n \n+        # Handle memoryview objects\n+        if isinstance(value, memoryview):\n+            return bytes(value)\n         # Handle string types -- we can't rely on force_bytes here because:\n         # - Python attempts str conversion first\n         # - when self._charset != 'utf-8' it re-encodes the content\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-11133/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11138", "model_patch": "--- a/django/db/backends/mysql/operations.py\n+++ b/django/db/backends/mysql/operations.py\n@@ -70,7 +70,10 @@\n \n     def _convert_field_to_tz(self, field_name, tzname):\n         if settings.USE_TZ:\n-            field_name = \"CONVERT_TZ(%s, 'UTC', '%s')\" % (field_name, tzname)\n+            # Use the database's TIME_ZONE setting as the source timezone,\n+            # otherwise fall back to 'UTC'\n+            source_tz = self.connection.settings_dict.get('TIME_ZONE') or 'UTC'\n+            field_name = \"CONVERT_TZ(%s, '%s', '%s')\" % (field_name, source_tz, tzname)\n         return field_name\n \n     def datetime_cast_date_sql(self, field_name, tzname):\n", "leaf_id": 11, "source_tree_path": "tmp/trajectory/django__django-11138/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11141", "model_patch": "--- a/django/db/migrations/loader.py\n+++ b/django/db/migrations/loader.py\n@@ -84,11 +84,6 @@\n                     continue\n                 raise\n             else:\n-                # Empty directories are namespaces.\n-                # getattr() needed on PY36 and older (replace w/attribute access).\n-                if getattr(module, '__file__', None) is None:\n-                    self.unmigrated_apps.add(app_config.label)\n-                    continue\n                 # Module is not a package (e.g. migrations.py).\n                 if not hasattr(module, '__path__'):\n                     self.unmigrated_apps.add(app_config.label)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11141/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11149", "model_patch": "--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -2114,28 +2114,28 @@\n     def has_add_permission(self, request, obj):\n         if self.opts.auto_created:\n             # We're checking the rights to an auto-created intermediate model,\n-            # which doesn't have its own individual permissions. The user needs\n-            # to have the view permission for the related model in order to\n-            # be able to do anything with the intermediate model.\n-            return self.has_view_permission(request, obj)\n+            # which doesn't have its own individual permissions. Users should\n+            # not be able to add to auto-created models unless they have\n+            # explicit add permission.\n+            return False\n         return super().has_add_permission(request)\n \n     def has_change_permission(self, request, obj=None):\n         if self.opts.auto_created:\n             # We're checking the rights to an auto-created intermediate model,\n-            # which doesn't have its own individual permissions. The user needs\n-            # to have the view permission for the related model in order to\n-            # be able to do anything with the intermediate model.\n-            return self.has_view_permission(request, obj)\n+            # which doesn't have its own individual permissions. Users should\n+            # not be able to change auto-created models unless they have\n+            # explicit change permission.\n+            return False\n         return super().has_change_permission(request)\n \n     def has_delete_permission(self, request, obj=None):\n         if self.opts.auto_created:\n             # We're checking the rights to an auto-created intermediate model,\n-            # which doesn't have its own individual permissions. The user needs\n-            # to have the view permission for the related model in order to\n-            # be able to do anything with the intermediate model.\n-            return self.has_view_permission(request, obj)\n+            # which doesn't have its own individual permissions. Users should\n+            # not be able to delete from auto-created models unless they have\n+            # explicit delete permission.\n+            return False\n         return super().has_delete_permission(request, obj)\n \n     def has_view_permission(self, request, obj=None):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-11149/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11163", "model_patch": "--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -83,7 +83,7 @@\n     for f in chain(opts.concrete_fields, opts.private_fields, opts.many_to_many):\n         if not getattr(f, 'editable', False):\n             continue\n-        if fields and f.name not in fields:\n+        if fields is not None and f.name not in fields:\n             continue\n         if exclude and f.name in exclude:\n             continue\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-11163/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11179", "model_patch": "--- a/django/db/models/deletion.py\n+++ b/django/db/models/deletion.py\n@@ -277,6 +277,7 @@\n             if self.can_fast_delete(instance):\n                 with transaction.mark_for_rollback_on_error():\n                     count = sql.DeleteQuery(model).delete_batch([instance.pk], self.using)\n+                setattr(instance, model._meta.pk.attname, None)\n                 return count, {model._meta.label: count}\n \n         with transaction.atomic(using=self.using, savepoint=False):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-11179/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11206", "model_patch": "--- a/django/utils/numberformat.py\n+++ b/django/utils/numberformat.py\n@@ -27,20 +27,25 @@\n     # sign\n     sign = ''\n     if isinstance(number, Decimal):\n-        # Format values with more than 200 digits (an arbitrary cutoff) using\n-        # scientific notation to avoid high memory usage in {:f}'.format().\n-        _, digits, exponent = number.as_tuple()\n-        if abs(exponent) + len(digits) > 200:\n-            number = '{:e}'.format(number)\n-            coefficient, exponent = number.split('e')\n-            # Format the coefficient.\n-            coefficient = format(\n-                coefficient, decimal_sep, decimal_pos, grouping,\n-                thousand_sep, force_grouping, use_l10n,\n-            )\n-            return '{}e{}'.format(coefficient, exponent)\n+        # When decimal_pos is specified and the number is smaller than what can be\n+        # represented with the given decimal positions, return formatted zero.\n+        if decimal_pos is not None and abs(number) < Decimal(10) ** (-decimal_pos):\n+            str_number = '0' + decimal_sep + ('0' * decimal_pos)\n         else:\n-            str_number = '{:f}'.format(number)\n+            # Format values with more than 200 digits (an arbitrary cutoff) using\n+            # scientific notation to avoid high memory usage in {:f}'.format().\n+            _, digits, exponent = number.as_tuple()\n+            if abs(exponent) + len(digits) > 200:\n+                number = '{:e}'.format(number)\n+                coefficient, exponent = number.split('e')\n+                # Format the coefficient.\n+                coefficient = format(\n+                    coefficient, decimal_sep, decimal_pos, grouping,\n+                    thousand_sep, force_grouping, use_l10n,\n+                )\n+                return '{}e{}'.format(coefficient, exponent)\n+            else:\n+                str_number = '{:f}'.format(number)\n     else:\n         str_number = str(number)\n     if str_number[0] == '-':\n", "leaf_id": 10, "source_tree_path": "tmp/trajectory/django__django-11206/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11211", "model_patch": "--- a/django/contrib/contenttypes/fields.py\n+++ b/django/contrib/contenttypes/fields.py\n@@ -207,7 +207,7 @@\n \n         return (\n             ret_val,\n-            lambda obj: (obj.pk, obj.__class__),\n+            lambda obj: (obj.__class__._meta.pk.get_prep_value(obj.pk), obj.__class__),\n             gfk_key,\n             True,\n             self.name,\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11211/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11239", "model_patch": "--- a/django/db/backends/postgresql/client.py\n+++ b/django/db/backends/postgresql/client.py\n@@ -30,6 +30,21 @@\n         subprocess_env = os.environ.copy()\n         if passwd:\n             subprocess_env['PGPASSWORD'] = str(passwd)\n+        \n+        # Add SSL parameters as environment variables\n+        sslmode = conn_params.get('sslmode')\n+        sslrootcert = conn_params.get('sslrootcert')\n+        sslcert = conn_params.get('sslcert')\n+        sslkey = conn_params.get('sslkey')\n+        \n+        if sslmode:\n+            subprocess_env['PGSSLMODE'] = str(sslmode)\n+        if sslrootcert:\n+            subprocess_env['PGSSLROOTCERT'] = str(sslrootcert)\n+        if sslcert:\n+            subprocess_env['PGSSLCERT'] = str(sslcert)\n+        if sslkey:\n+            subprocess_env['PGSSLKEY'] = str(sslkey)\n         try:\n             # Allow SIGINT to pass to psql to abort queries.\n             signal.signal(signal.SIGINT, signal.SIG_IGN)\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-11239/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11265", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1666,6 +1666,8 @@\n             filter_expr = (filter_lhs, OuterRef(filter_rhs.name))\n         # Generate the inner query.\n         query = Query(self.model)\n+        query._filtered_relations = self._filtered_relations.copy()\n+        query.annotations = self.annotations.copy()\n         query.add_filter(filter_expr)\n         query.clear_ordering(True)\n         # Try to have as simple as possible subquery -> trim leading joins from\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11265/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11276", "model_patch": "--- a/django/utils/html.py\n+++ b/django/utils/html.py\n@@ -1,5 +1,6 @@\n \"\"\"HTML utilities suitable for global use.\"\"\"\n \n+import html\n import json\n import re\n from html.parser import HTMLParser\n@@ -43,7 +44,7 @@\n     This may result in double-escaping. If this is a concern, use\n     conditional_escape() instead.\n     \"\"\"\n-    return mark_safe(str(text).translate(_html_escapes))\n+    return mark_safe(html.escape(str(text), quote=True))\n \n \n _js_escapes = {\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11276/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11292", "model_patch": "--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -285,6 +285,10 @@\n         parser.add_argument(\n             '--force-color', action='store_true',\n             help='Force colorization of the command output.',\n+        )\n+        parser.add_argument(\n+            '--skip-checks', action='store_true',\n+            help='Skip system checks.',\n         )\n         self.add_arguments(parser)\n         return parser\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11292/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11299", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1338,7 +1338,7 @@\n             if isinstance(child, Node):\n                 child_clause, needed_inner = self._add_q(\n                     child, used_aliases, branch_negated,\n-                    current_negated, allow_joins, split_subq)\n+                    current_negated, allow_joins, split_subq, simple_col)\n                 joinpromoter.add_votes(needed_inner)\n             else:\n                 child_clause, needed_inner = self.build_filter(\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-11299/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11333", "model_patch": "--- a/django/urls/resolvers.py\n+++ b/django/urls/resolvers.py\n@@ -64,10 +64,14 @@\n \n \n @functools.lru_cache(maxsize=None)\n+def _get_resolver(urlconf):\n+    return URLResolver(RegexPattern(r'^/'), urlconf)\n+\n+\n def get_resolver(urlconf=None):\n     if urlconf is None:\n         urlconf = settings.ROOT_URLCONF\n-    return URLResolver(RegexPattern(r'^/'), urlconf)\n+    return _get_resolver(urlconf)\n \n \n @functools.lru_cache(maxsize=None)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11333/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11400", "model_patch": "--- a/django/contrib/admin/filters.py\n+++ b/django/contrib/admin/filters.py\n@@ -198,6 +198,8 @@\n         related_admin = model_admin.admin_site._registry.get(field.remote_field.model)\n         if related_admin is not None:\n             ordering = related_admin.get_ordering(request)\n+        if not ordering:\n+            ordering = field.remote_field.model._meta.ordering\n         return field.get_choices(include_blank=False, ordering=ordering)\n \n     def choices(self, changelist):\n@@ -419,4 +421,10 @@\n class RelatedOnlyFieldListFilter(RelatedFieldListFilter):\n     def field_choices(self, field, request, model_admin):\n         pk_qs = model_admin.get_queryset(request).distinct().values_list('%s__pk' % self.field_path, flat=True)\n-        return field.get_choices(include_blank=False, limit_choices_to={'pk__in': pk_qs})\n+        ordering = ()\n+        related_admin = model_admin.admin_site._registry.get(field.remote_field.model)\n+        if related_admin is not None:\n+            ordering = related_admin.get_ordering(request)\n+        if not ordering:\n+            ordering = field.remote_field.model._meta.ordering\n+        return field.get_choices(include_blank=False, limit_choices_to={'pk__in': pk_qs}, ordering=ordering)\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-11400/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11433", "model_patch": "--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -49,7 +49,8 @@\n         # Leave defaults for fields that aren't in POST data, except for\n         # checkbox inputs because they don't appear in POST data if not checked.\n         if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n+                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name)) and\n+                f.name not in cleaned_data):\n             continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-11433/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11451", "model_patch": "--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,8 @@\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-11451/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11490", "model_patch": "--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -425,7 +425,7 @@\n                 # If the columns list is limited, then all combined queries\n                 # must have the same columns list. Set the selects defined on\n                 # the query on all combined queries, if not already set.\n-                if not compiler.query.values_select and self.query.values_select:\n+                if self.query.values_select:\n                     compiler.query.set_values((\n                         *self.query.extra_select,\n                         *self.query.values_select,\n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-11490/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11532", "model_patch": "--- a/django/core/mail/utils.py\n+++ b/django/core/mail/utils.py\n@@ -13,7 +13,13 @@\n \n     def get_fqdn(self):\n         if not hasattr(self, '_fqdn'):\n-            self._fqdn = socket.getfqdn()\n+            fqdn = socket.getfqdn()\n+            # Convert non-ASCII domain names to punycode to avoid encoding issues\n+            try:\n+                fqdn.encode('ascii')\n+            except UnicodeEncodeError:\n+                fqdn = fqdn.encode('idna').decode('ascii')\n+            self._fqdn = fqdn\n         return self._fqdn\n \n \n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-11532/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11551", "model_patch": "--- a/django/contrib/admin/checks.py\n+++ b/django/contrib/admin/checks.py\n@@ -720,33 +720,33 @@\n             return []\n         elif hasattr(obj, item):\n             return []\n-        elif hasattr(obj.model, item):\n+        else:\n             try:\n                 field = obj.model._meta.get_field(item)\n             except FieldDoesNotExist:\n-                return []\n-            else:\n-                if isinstance(field, models.ManyToManyField):\n+                try:\n+                    field = getattr(obj.model, item)\n+                except AttributeError:\n                     return [\n                         checks.Error(\n-                            \"The value of '%s' must not be a ManyToManyField.\" % label,\n+                            \"The value of '%s' refers to '%s', which is not a callable, \"\n+                            \"an attribute of '%s', or an attribute or method on '%s.%s'.\" % (\n+                                label, item, obj.__class__.__name__,\n+                                obj.model._meta.app_label, obj.model._meta.object_name,\n+                            ),\n                             obj=obj.__class__,\n-                            id='admin.E109',\n+                            id='admin.E108',\n                         )\n                     ]\n-                return []\n-        else:\n-            return [\n-                checks.Error(\n-                    \"The value of '%s' refers to '%s', which is not a callable, \"\n-                    \"an attribute of '%s', or an attribute or method on '%s.%s'.\" % (\n-                        label, item, obj.__class__.__name__,\n-                        obj.model._meta.app_label, obj.model._meta.object_name,\n-                    ),\n-                    obj=obj.__class__,\n-                    id='admin.E108',\n-                )\n-            ]\n+            if isinstance(field, models.ManyToManyField):\n+                return [\n+                    checks.Error(\n+                        \"The value of '%s' must not be a ManyToManyField.\" % label,\n+                        obj=obj.__class__,\n+                        id='admin.E109',\n+                    )\n+                ]\n+            return []\n \n     def _check_list_display_links(self, obj):\n         \"\"\" Check that list_display_links is a unique subset of list_display.\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11551/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11555", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -2217,7 +2217,26 @@\n     The 'default' param is used to indicate which way no prefix (or a '+'\n     prefix) should sort. The '-' prefix always sorts the opposite way.\n     \"\"\"\n+    from django.db.models.expressions import OrderBy\n+    \n     dirn = ORDER_DIR[default]\n+    \n+    # Handle OrderBy objects\n+    if isinstance(field, OrderBy):\n+        # For OrderBy objects, extract the field name from the expression\n+        # and determine direction from the descending attribute\n+        if hasattr(field.expression, 'name'):\n+            field_name = field.expression.name\n+        elif hasattr(field.expression, 'target') and hasattr(field.expression.target, 'name'):\n+            field_name = field.expression.target.name\n+        else:\n+            # Fallback: convert the expression to string\n+            field_name = str(field.expression)\n+        \n+        direction = 'DESC' if field.descending else 'ASC'\n+        return field_name, direction\n+    \n+    # Handle string fields (original logic)\n     if field[0] == '-':\n         return field[1:], dirn[1]\n     return field, dirn[0]\n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-11555/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11603", "model_patch": "--- a/django/db/models/aggregates.py\n+++ b/django/db/models/aggregates.py\n@@ -99,6 +99,7 @@\n class Avg(FixDurationInputMixin, NumericOutputFieldMixin, Aggregate):\n     function = 'AVG'\n     name = 'Avg'\n+    allow_distinct = True\n \n \n class Count(Aggregate):\n@@ -142,6 +143,7 @@\n class Sum(FixDurationInputMixin, Aggregate):\n     function = 'SUM'\n     name = 'Sum'\n+    allow_distinct = True\n \n \n class Variance(NumericOutputFieldMixin, Aggregate):\n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-11603/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11728", "model_patch": "--- a/django/contrib/admindocs/utils.py\n+++ b/django/contrib/admindocs/utils.py\n@@ -148,6 +148,59 @@\n # Match the beginning of a named or unnamed group.\n named_group_matcher = re.compile(r'\\(\\?P(<\\w+>)')\n unnamed_group_matcher = re.compile(r'\\(')\n+\n+# Test script to reproduce the bug\n+if __name__ == '__main__':\n+    # Test the bug where final named group is not replaced without trailing '/'\n+    print(\"Testing replace_named_groups() bug...\n+\")\n+    \n+    # Test case 1: The failing case (without trailing '/')\n+    pattern_without_slash = r'entries/(?P<pk>[^/.]+)/relationships/(?P<related_field>\\w+)'\n+    print(f\"Input pattern (without trailing '/'): {pattern_without_slash}\")\n+    result_without_slash = replace_named_groups(pattern_without_slash)\n+    print(f\"Result: {result_without_slash}\")\n+    \n+    # Check if both named groups were replaced\n+    expected_without_slash = 'entries/<pk>/relationships/<related_field>'\n+    if result_without_slash == expected_without_slash:\n+        print(\"â SUCCESS: Both named groups were replaced correctly\")\n+    else:\n+        print(\"â BUG CONFIRMED: Final named group 'related_field' was NOT replaced\")\n+        print(f\"Expected: {expected_without_slash}\")\n+        print(f\"Got:      {result_without_slash}\")\n+    \n+    print()\n+    \n+    # Test case 2: The working case (with trailing '/')\n+    pattern_with_slash = r'entries/(?P<pk>[^/.]+)/relationships/(?P<related_field>\\w+)/'\n+    print(f\"Input pattern (with trailing '/'): {pattern_with_slash}\")\n+    result_with_slash = replace_named_groups(pattern_with_slash)\n+    print(f\"Result: {result_with_slash}\")\n+    \n+    # Check if both named groups were replaced\n+    expected_with_slash = 'entries/<pk>/relationships/<related_field>/'\n+    if result_with_slash == expected_with_slash:\n+        print(\"â SUCCESS: Both named groups were replaced correctly\")\n+    else:\n+        print(\"â UNEXPECTED: This case should work but didn't\")\n+        print(f\"Expected: {expected_with_slash}\")\n+        print(f\"Got:      {result_with_slash}\")\n+    \n+    print()\n+    \n+    # Summary\n+    print(\"=== SUMMARY ===\")\n+    bug_exists = result_without_slash != expected_without_slash\n+    workaround_works = result_with_slash == expected_with_slash\n+    \n+    if bug_exists and workaround_works:\n+        print(\"BUG CONFIRMED: replace_named_groups() fails on patterns without trailing '/'\")\n+        print(\"WORKAROUND CONFIRMED: Adding trailing '/' makes it work\")\n+    elif not bug_exists:\n+        print(\"Bug not reproduced - function works correctly\")\n+    else:\n+        print(\"Unexpected behavior - workaround also fails\")\n \n \n def replace_named_groups(pattern):\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-11728/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11734", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1704,6 +1704,9 @@\n         filter_lhs, filter_rhs = filter_expr\n         if isinstance(filter_rhs, F):\n             filter_expr = (filter_lhs, OuterRef(filter_rhs.name))\n+        elif isinstance(filter_rhs, OuterRef):\n+            # OuterRef should be preserved as-is, don't wrap it again\n+            filter_expr = (filter_lhs, filter_rhs)\n         # Generate the inner query.\n         query = Query(self.model)\n         query._filtered_relations = self._filtered_relations\n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-11734/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11740", "model_patch": "--- a/django/db/migrations/autodetector.py\n+++ b/django/db/migrations/autodetector.py\n@@ -963,6 +963,10 @@\n                             preserve_default = False\n                     else:\n                         field = new_field\n+                    # Fields that are foreignkeys/m2ms depend on stuff\n+                    dependencies = []\n+                    if field.remote_field and field.remote_field.model:\n+                        dependencies.extend(self._get_dependencies_for_foreign_key(field))\n                     self.add_operation(\n                         app_label,\n                         operations.AlterField(\n@@ -970,7 +974,8 @@\n                             name=field_name,\n                             field=field,\n                             preserve_default=preserve_default,\n-                        )\n+                        ),\n+                        dependencies=dependencies,\n                     )\n                 else:\n                     # We cannot alter between m2m and concrete fields\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-11740/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11749", "model_patch": "--- a/django/core/management/__init__.py\n+++ b/django/core/management/__init__.py\n@@ -136,6 +136,12 @@\n         '{}={}'.format(min(opt.option_strings), arg_options[opt.dest])\n         for opt in parser_actions if opt.required and opt.dest in options\n     ]\n+    # Handle required mutually exclusive groups\n+    for group in parser._mutually_exclusive_groups:\n+        if group.required:\n+            for action in group._group_actions:\n+                if action.dest in arg_options:\n+                    parse_args.append('{}={}'.format(min(action.option_strings), arg_options[action.dest]))\n     defaults = parser.parse_args(args=parse_args)\n     defaults = dict(defaults._get_kwargs(), **arg_options)\n     # Raise an error if any unknown options were passed.\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-11749/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11790", "model_patch": "--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,12 @@\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11790/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11815", "model_patch": "--- a/django/db/migrations/serializer.py\n+++ b/django/db/migrations/serializer.py\n@@ -120,9 +120,9 @@\n     def serialize(self):\n         enum_class = self.value.__class__\n         module = enum_class.__module__\n-        v_string, v_imports = serializer_factory(self.value.value).serialize()\n+        v_string, v_imports = serializer_factory(self.value.name).serialize()\n         imports = {'import %s' % module, *v_imports}\n-        return \"%s.%s(%s)\" % (module, enum_class.__name__, v_string), imports\n+        return \"%s.%s[%s]\" % (module, enum_class.__name__, v_string), imports\n \n \n class FloatSerializer(BaseSimpleSerializer):\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11815/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11820", "model_patch": "--- a/django/db/models/base.py\n+++ b/django/db/models/base.py\n@@ -1706,12 +1706,16 @@\n         for field in related_fields:\n             _cls = cls\n             fld = None\n-            for part in field.split(LOOKUP_SEP):\n+            parts = field.split(LOOKUP_SEP)\n+            for i, part in enumerate(parts):\n                 try:\n                     fld = _cls._meta.get_field(part)\n                     if fld.is_relation:\n                         _cls = fld.get_path_info()[-1].to_opts.model\n                 except (FieldDoesNotExist, AttributeError):\n+                    # Special case: 'pk' is always valid as the final part of a field path\n+                    if part == 'pk' and i == len(parts) - 1:\n+                        break\n                     if fld is None or fld.get_transform(part) is None:\n                         errors.append(\n                             checks.Error(\n\n--- a/tests/invalid_models_tests/test_models.py\n+++ b/tests/invalid_models_tests/test_models.py\n@@ -814,6 +814,22 @@\n             )\n         ])\n \n+    def test_ordering_with_related_field_pk_should_be_valid(self):\n+        \"\"\"Test that ordering by related field's pk should not raise E015.\"\"\"\n+        class Option(models.Model):\n+            name = models.CharField(max_length=100)\n+\n+        class SomeModel(models.Model):\n+            option = models.ForeignKey(Option, models.CASCADE)\n+            \n+            class Meta:\n+                ordering = ('option__pk',)\n+\n+        # This should not raise any errors as 'option__pk' is a valid ordering\n+        errors = SomeModel.check()\n+        # With the fix in place, this should pass with no errors\n+        self.assertEqual(errors, [])\n+\n     def test_ordering_allows_registered_lookups(self):\n         class Model(models.Model):\n             test = models.CharField(max_length=100)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11820/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11848", "model_patch": "--- a/django/utils/http.py\n+++ b/django/utils/http.py\n@@ -176,10 +176,13 @@\n     try:\n         year = int(m.group('year'))\n         if year < 100:\n-            if year < 70:\n-                year += 2000\n+            current_year = datetime.datetime.now().year\n+            current_century = (current_year // 100) * 100\n+            full_year = current_century + year\n+            if full_year - current_year > 50:\n+                year = full_year - 100\n             else:\n-                year += 1900\n+                year = full_year\n         month = MONTHS.index(m.group('mon').lower()) + 1\n         day = int(m.group('day'))\n         hour = int(m.group('hour'))\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-11848/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11880", "model_patch": "--- a/django/forms/fields.py\n+++ b/django/forms/fields.py\n@@ -199,6 +199,7 @@\n         result = copy.copy(self)\n         memo[id(self)] = result\n         result.widget = copy.deepcopy(self.widget, memo)\n+        result.error_messages = copy.deepcopy(self.error_messages, memo)\n         result.validators = self.validators[:]\n         return result\n \n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-11880/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11885", "model_patch": "--- a/django/db/models/deletion.py\n+++ b/django/db/models/deletion.py\n@@ -310,9 +310,40 @@\n                     )\n \n             # fast deletes\n+            # Group querysets by model to combine WHERE conditions with OR\n+            fast_deletes_by_model = {}\n             for qs in self.fast_deletes:\n-                count = qs._raw_delete(using=self.using)\n-                deleted_counter[qs.model._meta.label] += count\n+                model = qs.model\n+                if model not in fast_deletes_by_model:\n+                    fast_deletes_by_model[model] = []\n+                fast_deletes_by_model[model].append(qs)\n+            \n+            for model, querysets in fast_deletes_by_model.items():\n+                if len(querysets) == 1:\n+                    # Single queryset, execute as before\n+                    count = querysets[0]._raw_delete(using=self.using)\n+                    deleted_counter[model._meta.label] += count\n+                else:\n+                    # Multiple querysets for same model, combine with OR\n+                    from django.db.models.sql.where import OR, WhereNode\n+                    \n+                    # Create a new queryset based on the first one\n+                    combined_qs = querysets[0]._chain()\n+                    \n+                    # Create a new WhereNode with OR connector\n+                    combined_where = WhereNode(connector=OR)\n+                    \n+                    # Add each queryset's WHERE clause as a child\n+                    for qs in querysets:\n+                        if qs.query.where.children:\n+                            combined_where.children.append(qs.query.where)\n+                    \n+                    # Set the combined WHERE clause\n+                    combined_qs.query.where = combined_where\n+                    \n+                    # Execute the combined query\n+                    count = combined_qs._raw_delete(using=self.using)\n+                    deleted_counter[model._meta.label] += count\n \n             # update fields\n             for model, instances_for_fieldvalues in self.field_updates.items():\n", "leaf_id": 16, "source_tree_path": "tmp/trajectory/django__django-11885/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11951", "model_patch": "--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -1209,7 +1209,8 @@\n         if ignore_conflicts and not connections[self.db].features.supports_ignore_conflicts:\n             raise NotSupportedError('This database backend does not support ignoring conflicts.')\n         ops = connections[self.db].ops\n-        batch_size = (batch_size or max(ops.bulk_batch_size(fields, objs), 1))\n+        max_batch_size = max(ops.bulk_batch_size(fields, objs), 1)\n+        batch_size = min(batch_size, max_batch_size) if batch_size else max_batch_size\n         inserted_rows = []\n         bulk_return = connections[self.db].features.can_return_rows_from_bulk_insert\n         for item in [objs[i:i + batch_size] for i in range(0, len(objs), batch_size)]:\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11951/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11964", "model_patch": "--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -14,6 +14,7 @@\n from django.core import checks, exceptions, validators\n from django.db import connection, connections, router\n from django.db.models.constants import LOOKUP_SEP\n+from django.db.models.enums import Choices\n from django.db.models.query_utils import DeferredAttribute, RegisterLookupMixin\n from django.utils import timezone\n from django.utils.datastructures import DictWrapper\n@@ -1010,6 +1011,8 @@\n     def to_python(self, value):\n         if isinstance(value, str) or value is None:\n             return value\n+        if isinstance(value, Choices):\n+            return str(value.value)\n         return str(value)\n \n     def get_prep_value(self, value):\n@@ -1769,6 +1772,8 @@\n     def to_python(self, value):\n         if value is None:\n             return value\n+        if isinstance(value, Choices):\n+            value = value.value\n         try:\n             return int(value)\n         except (TypeError, ValueError):\n", "leaf_id": 19, "source_tree_path": "tmp/trajectory/django__django-11964/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-11999", "model_patch": "--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -763,8 +763,11 @@\n             if not getattr(cls, self.attname, None):\n                 setattr(cls, self.attname, self.descriptor_class(self))\n         if self.choices is not None:\n-            setattr(cls, 'get_%s_display' % self.name,\n-                    partialmethod(cls._get_FIELD_display, field=self))\n+            # Only set the get_FOO_display method if it doesn't already exist\n+            # to allow custom overrides\n+            if not hasattr(cls, 'get_%s_display' % self.name):\n+                setattr(cls, 'get_%s_display' % self.name,\n+                        partialmethod(cls._get_FIELD_display, field=self))\n \n     def get_filter_kwargs_for_object(self, obj):\n         \"\"\"\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-11999/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12039", "model_patch": "--- a/django/db/backends/ddl_references.py\n+++ b/django/db/backends/ddl_references.py\n@@ -112,9 +112,12 @@\n         def col_str(column, idx):\n             # Index.__init__() guarantees that self.opclasses is the same\n             # length as self.columns.\n-            col = '{} {}'.format(self.quote_name(column), self.opclasses[idx])\n+            col = self.quote_name(column)\n+            if self.opclasses[idx]:\n+                col = '{} {}'.format(col, self.opclasses[idx])\n             try:\n-                col = '{} {}'.format(col, self.col_suffixes[idx])\n+                if self.col_suffixes[idx]:\n+                    col = '{} {}'.format(col, self.col_suffixes[idx])\n             except IndexError:\n                 pass\n             return col\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-12039/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12050", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1073,7 +1073,7 @@\n                         ))\n                 else:\n                     resolved_values.append(sub_value)\n-            value = tuple(resolved_values)\n+            value = type(value)(resolved_values)\n         return value\n \n     def solve_lookup_type(self, lookup):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-12050/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12125", "model_patch": "--- a/django/db/migrations/serializer.py\n+++ b/django/db/migrations/serializer.py\n@@ -269,7 +269,7 @@\n             if module == builtins.__name__:\n                 return self.value.__name__, set()\n             else:\n-                return \"%s.%s\" % (module, self.value.__name__), {\"import %s\" % module}\n+                return \"%s.%s\" % (module, self.value.__qualname__), {\"import %s\" % module}\n \n \n class UUIDSerializer(BaseSerializer):\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-12125/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12143", "model_patch": "--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -1631,7 +1631,7 @@\n \n     def _get_edited_object_pks(self, request, prefix):\n         \"\"\"Return POST data values of list_editable primary keys.\"\"\"\n-        pk_pattern = re.compile(r'{}-\\d+-{}$'.format(prefix, self.model._meta.pk.name))\n+        pk_pattern = re.compile(r'{}-\\d+-{}$'.format(re.escape(prefix), self.model._meta.pk.name))\n         return [value for key, value in request.POST.items() if pk_pattern.match(key)]\n \n     def _get_list_editable_queryset(self, request, prefix):\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-12143/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12155", "model_patch": "--- a/django/contrib/admindocs/utils.py\n+++ b/django/contrib/admindocs/utils.py\n@@ -34,7 +34,7 @@\n         return ''\n     # Convert tabs to spaces and split into lines\n     lines = docstring.expandtabs().splitlines()\n-    indent = min(len(line) - len(line.lstrip()) for line in lines if line.lstrip())\n+    indent = min(len(line) - len(line.lstrip()) for line in lines[1:] if line.lstrip())\n     trimmed = [lines[0].lstrip()] + [line[indent:].rstrip() for line in lines[1:]]\n     return \"\\n\".join(trimmed).strip()\n \n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-12155/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12193", "model_patch": "--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -144,10 +144,13 @@\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Create a copy of final_attrs for each iteration to prevent\n+            # widgets from modifying the shared attrs dictionary\n+            widget_attrs = final_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                widget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, widget_attrs)['widget']\n             )\n         return context\n \n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-12193/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12209", "model_patch": "--- a/django/db/models/base.py\n+++ b/django/db/models/base.py\n@@ -414,6 +414,23 @@\n \n         # Set up the storage for instance state\n         self._state = ModelState()\n+        \n+        # Check if an explicit primary key value is provided\n+        pk_field = opts.pk\n+        pk_set_explicitly = False\n+        \n+        # Check if pk is provided in kwargs\n+        if kwargs and (pk_field.name in kwargs or pk_field.attname in kwargs):\n+            pk_set_explicitly = True\n+        \n+        # Check if pk is provided in args (first field is pk for concrete fields)\n+        if args and len(args) > 0 and opts.concrete_fields and opts.concrete_fields[0] == pk_field:\n+            if args[0] is not _DEFERRED:\n+                pk_set_explicitly = True\n+        \n+        # If pk was explicitly set, this is not a new instance\n+        if pk_set_explicitly:\n+            self._state.adding = False\n \n         # There is a rather weird disparity here; if kwargs, it's set, then args\n         # overrides it. It should be one or the other; don't duplicate the work\n", "leaf_id": 10, "source_tree_path": "tmp/trajectory/django__django-12209/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12262", "model_patch": "--- a/django/template/library.py\n+++ b/django/template/library.py\n@@ -261,7 +261,7 @@\n         if kwarg:\n             # The kwarg was successfully extracted\n             param, value = kwarg.popitem()\n-            if param not in params and param not in unhandled_kwargs and varkw is None:\n+            if param not in params and param not in kwonly and param not in unhandled_kwargs and varkw is None:\n                 # An unexpected keyword argument was supplied\n                 raise TemplateSyntaxError(\n                     \"'%s' received unexpected keyword argument '%s'\" %\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-12262/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12276", "model_patch": "--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -386,6 +386,9 @@\n \n     def value_omitted_from_data(self, data, files, name):\n         return name not in files\n+\n+    def use_required_attribute(self, initial):\n+        return super().use_required_attribute(initial) and not initial\n \n \n FILE_INPUT_CONTRADICTION = object()\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-12276/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12304", "model_patch": "--- a/django/db/models/enums.py\n+++ b/django/db/models/enums.py\n@@ -31,6 +31,7 @@\n         # that is passed in as \"self\" as the value to use when looking up the\n         # label in the choices.\n         cls.label = property(lambda self: cls._value2label_map_.get(self.value))\n+        cls.do_not_call_in_templates = True\n         return enum.unique(cls)\n \n     def __contains__(cls, member):\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-12304/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12308", "model_patch": "--- a/django/contrib/admin/utils.py\n+++ b/django/contrib/admin/utils.py\n@@ -398,6 +398,8 @@\n         return formats.number_format(value)\n     elif isinstance(field, models.FileField) and value:\n         return format_html('<a href=\"{}\">{}</a>', value.url, value)\n+    elif isinstance(field, models.JSONField):\n+        return field.formfield().prepare_value(value)\n     else:\n         return display_for_value(value, empty_value_display)\n \n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-12308/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12325", "model_patch": "--- a/django/db/models/options.py\n+++ b/django/db/models/options.py\n@@ -241,8 +241,16 @@\n         if self.pk is None:\n             if self.parents:\n                 # Promote the first parent link in lieu of adding yet another\n-                # field.\n-                field = next(iter(self.parents.values()))\n+                # field. Prioritize fields with parent_link=True over declaration order.\n+                parent_link_field = None\n+                fallback_field = None\n+                for field in self.parents.values():\n+                    if fallback_field is None:\n+                        fallback_field = field\n+                    if field and getattr(field.remote_field, 'parent_link', False):\n+                        parent_link_field = field\n+                        break\n+                field = parent_link_field or fallback_field\n                 # Look for a local field with the same name as the\n                 # first parent link. If a local field has already been\n                 # created, use it instead of promoting the parent\n\n--- a/tests/invalid_models_tests/test_models.py\n+++ b/tests/invalid_models_tests/test_models.py\n@@ -1015,6 +1015,80 @@\n             class ParkingLot(Place):\n                 parent = models.OneToOneField(Place, models.CASCADE)\n \n+    def test_parent_link_after_other_onetoonefield(self):\n+        \"\"\"\n+        Test that parent_link=True field works even when declared after\n+        other OneToOneField references to the same parent model.\n+        \"\"\"\n+        # This should not raise ImproperlyConfigured\n+        class Document(models.Model):\n+            pass\n+\n+        class Picking(Document):\n+            # This field comes first but is not the parent link\n+            origin = models.OneToOneField(Document, related_name='picking', on_delete=models.PROTECT)\n+            # This field comes second but IS the parent link\n+            document_ptr = models.OneToOneField(Document, on_delete=models.CASCADE, parent_link=True, related_name='+')\n+\n+    def test_parent_link_before_other_onetoonefield(self):\n+        \"\"\"\n+        Test that parent_link=True field works when declared before\n+        other OneToOneField references to the same parent model.\n+        \"\"\"\n+        # This should not raise ImproperlyConfigured\n+        class Document(models.Model):\n+            pass\n+\n+        class Picking(Document):\n+            # This field comes first and IS the parent link\n+            document_ptr = models.OneToOneField(Document, on_delete=models.CASCADE, parent_link=True, related_name='+')\n+            # This field comes second but is not the parent link\n+            origin = models.OneToOneField(Document, related_name='picking', on_delete=models.PROTECT)\n+\n+    def test_multiple_parent_link_fields_error(self):\n+        \"\"\"\n+        Test that having multiple parent_link=True fields raises an error.\n+        \"\"\"\n+        with self.assertRaises(ImproperlyConfigured):\n+            class Document(models.Model):\n+                pass\n+\n+            class Picking(Document):\n+                document_ptr1 = models.OneToOneField(Document, on_delete=models.CASCADE, parent_link=True, related_name='+')\n+                document_ptr2 = models.OneToOneField(Document, on_delete=models.CASCADE, parent_link=True, related_name='++')\n+\n+    def test_no_parent_link_with_inheritance_error(self):\n+        \"\"\"\n+        Test that inheriting from a model without specifying parent_link=True\n+        on any OneToOneField to the parent raises ImproperlyConfigured.\n+        \"\"\"\n+        msg = 'Add parent_link=True to invalid_models_tests.Picking.origin.'\n+        with self.assertRaisesMessage(ImproperlyConfigured, msg):\n+            class Document(models.Model):\n+                pass\n+\n+            class Picking(Document):\n+                # This field references the parent but doesn't have parent_link=True\n+                origin = models.OneToOneField(Document, related_name='picking', on_delete=models.PROTECT)\n+\n+    def test_parent_link_with_different_parent_model(self):\n+        \"\"\"\n+        Test that OneToOneField to a different model doesn't interfere\n+        with parent link detection.\n+        \"\"\"\n+        # This should not raise ImproperlyConfigured\n+        class Document(models.Model):\n+            pass\n+\n+        class User(models.Model):\n+            pass\n+\n+        class Picking(Document):\n+            # This field references a different model, not the parent\n+            user = models.OneToOneField(User, on_delete=models.CASCADE)\n+            # This field is the actual parent link\n+            document_ptr = models.OneToOneField(Document, on_delete=models.CASCADE, parent_link=True, related_name='+')\n+\n     def test_m2m_table_name_clash(self):\n         class Foo(models.Model):\n             bar = models.ManyToManyField('Bar', db_table='myapp_bar')\n", "leaf_id": 11, "source_tree_path": "tmp/trajectory/django__django-12325/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12406", "model_patch": "--- a/django/db/models/fields/related.py\n+++ b/django/db/models/fields/related.py\n@@ -975,12 +975,16 @@\n             raise ValueError(\"Cannot create form field for %r yet, because \"\n                              \"its related model %r has not been loaded yet\" %\n                              (self.name, self.remote_field.model))\n-        return super().formfield(**{\n+        defaults = {\n             'form_class': forms.ModelChoiceField,\n             'queryset': self.remote_field.model._default_manager.using(using),\n             'to_field_name': self.remote_field.field_name,\n-            **kwargs,\n-        })\n+        }\n+        # Set empty_label to None when blank=False to prevent blank option in RadioSelect\n+        if not self.blank:\n+            defaults['empty_label'] = None\n+        defaults.update(kwargs)\n+        return super().formfield(**defaults)\n \n     def db_check(self, connection):\n         return []\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-12406/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12419", "model_patch": "--- a/django/conf/global_settings.py\n+++ b/django/conf/global_settings.py\n@@ -637,6 +637,6 @@\n SECURE_HSTS_PRELOAD = False\n SECURE_HSTS_SECONDS = 0\n SECURE_REDIRECT_EXEMPT = []\n-SECURE_REFERRER_POLICY = None\n+SECURE_REFERRER_POLICY = 'same-origin'\n SECURE_SSL_HOST = None\n SECURE_SSL_REDIRECT = False\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-12419/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12663", "model_patch": "--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -21,7 +21,7 @@\n     parse_date, parse_datetime, parse_duration, parse_time,\n )\n from django.utils.duration import duration_microseconds, duration_string\n-from django.utils.functional import Promise, cached_property\n+from django.utils.functional import Promise, SimpleLazyObject, cached_property\n from django.utils.ipv6 import clean_ipv6_address\n from django.utils.itercompat import is_iterable\n from django.utils.text import capfirst\n", "leaf_id": 18, "source_tree_path": "tmp/trajectory/django__django-12663/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12708", "model_patch": "--- a/django/db/backends/base/schema.py\n+++ b/django/db/backends/base/schema.py\n@@ -403,6 +403,17 @@\n         meta_constraint_names = {constraint.name for constraint in model._meta.constraints}\n         meta_index_names = {constraint.name for constraint in model._meta.indexes}\n         columns = [model._meta.get_field(field).column for field in fields]\n+        \n+        # When looking for index constraints, explicitly exclude unique constraints\n+        # When looking for unique constraints, explicitly exclude index constraints\n+        # This prevents conflicts when both exist on the same fields\n+        if constraint_kwargs.get('index') is True:\n+            constraint_kwargs = constraint_kwargs.copy()\n+            constraint_kwargs['unique'] = False\n+        elif constraint_kwargs.get('unique') is True:\n+            constraint_kwargs = constraint_kwargs.copy()\n+            constraint_kwargs['index'] = False\n+            \n         constraint_names = self._constraint_names(\n             model, columns, exclude=meta_constraint_names | meta_index_names,\n             **constraint_kwargs\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-12708/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12713", "model_patch": "--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -249,16 +249,17 @@\n             return None\n         db = kwargs.get('using')\n \n-        autocomplete_fields = self.get_autocomplete_fields(request)\n-        if db_field.name in autocomplete_fields:\n-            kwargs['widget'] = AutocompleteSelectMultiple(db_field.remote_field, self.admin_site, using=db)\n-        elif db_field.name in self.raw_id_fields:\n-            kwargs['widget'] = widgets.ManyToManyRawIdWidget(db_field.remote_field, self.admin_site, using=db)\n-        elif db_field.name in [*self.filter_vertical, *self.filter_horizontal]:\n-            kwargs['widget'] = widgets.FilteredSelectMultiple(\n-                db_field.verbose_name,\n-                db_field.name in self.filter_vertical\n-            )\n+        if 'widget' not in kwargs:\n+            autocomplete_fields = self.get_autocomplete_fields(request)\n+            if db_field.name in autocomplete_fields:\n+                kwargs['widget'] = AutocompleteSelectMultiple(db_field.remote_field, self.admin_site, using=db)\n+            elif db_field.name in self.raw_id_fields:\n+                kwargs['widget'] = widgets.ManyToManyRawIdWidget(db_field.remote_field, self.admin_site, using=db)\n+            elif db_field.name in [*self.filter_vertical, *self.filter_horizontal]:\n+                kwargs['widget'] = widgets.FilteredSelectMultiple(\n+                    db_field.verbose_name,\n+                    db_field.name in self.filter_vertical\n+                )\n \n         if 'queryset' not in kwargs:\n             queryset = self.get_field_queryset(db, db_field, request)\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-12713/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12741", "model_patch": "--- a/django/db/backends/base/operations.py\n+++ b/django/db/backends/base/operations.py\n@@ -400,9 +400,9 @@\n         \"\"\"\n         raise NotImplementedError('subclasses of BaseDatabaseOperations must provide a sql_flush() method')\n \n-    def execute_sql_flush(self, using, sql_list):\n+    def execute_sql_flush(self, sql_list):\n         \"\"\"Execute a list of SQL statements to flush the database.\"\"\"\n-        with transaction.atomic(using=using, savepoint=self.connection.features.can_rollback_ddl):\n+        with transaction.atomic(using=self.connection.alias, savepoint=self.connection.features.can_rollback_ddl):\n             with self.connection.cursor() as cursor:\n                 for sql in sql_list:\n                     cursor.execute(sql)\n\n--- a/django/core/management/commands/flush.py\n+++ b/django/core/management/commands/flush.py\n@@ -60,7 +60,7 @@\n \n         if confirm == 'yes':\n             try:\n-                connection.ops.execute_sql_flush(database, sql_list)\n+                connection.ops.execute_sql_flush(sql_list)\n             except Exception as exc:\n                 raise CommandError(\n                     \"Database %s couldn't be flushed. Possible reasons:\\n\"\n\n--- a/tests/backends/base/test_operations.py\n+++ b/tests/backends/base/test_operations.py\n@@ -172,7 +172,7 @@\n             reset_sequences=True,\n             allow_cascade=True,\n         )\n-        connection.ops.execute_sql_flush(connection.alias, sql_list)\n+        connection.ops.execute_sql_flush(sql_list)\n \n         with transaction.atomic():\n             self.assertIs(Author.objects.exists(), False)\n\n--- a/tests/backends/tests.py\n+++ b/tests/backends/tests.py\n@@ -162,7 +162,7 @@\n             VLM_m2m._meta.db_table,\n         ]\n         sql_list = connection.ops.sql_flush(no_style(), tables, reset_sequences=True)\n-        connection.ops.execute_sql_flush(connection.alias, sql_list)\n+        connection.ops.execute_sql_flush(sql_list)\n \n \n class SequenceResetTest(TestCase):\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-12741/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12774", "model_patch": "--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -690,7 +690,13 @@\n         assert not self.query.is_sliced, \\\n             \"Cannot use 'limit' or 'offset' with in_bulk\"\n         if field_name != 'pk' and not self.model._meta.get_field(field_name).unique:\n-            raise ValueError(\"in_bulk()'s field_name must be a unique field but %r isn't.\" % field_name)\n+            # Check if field is unique through a single-field UniqueConstraint\n+            is_unique_constraint = any(\n+                len(constraint.fields) == 1 and constraint.fields[0] == field_name\n+                for constraint in self.model._meta.total_unique_constraints\n+            )\n+            if not is_unique_constraint:\n+                raise ValueError(\"in_bulk()'s field_name must be a unique field but %r isn't.\" % field_name)\n         if id_list is not None:\n             if not id_list:\n                 return {}\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-12774/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12858", "model_patch": "--- a/django/db/models/base.py\n+++ b/django/db/models/base.py\n@@ -1747,7 +1747,7 @@\n                     else:\n                         _cls = None\n                 except (FieldDoesNotExist, AttributeError):\n-                    if fld is None or fld.get_transform(part) is None:\n+                    if fld is None or (fld.get_transform(part) is None and fld.get_lookup(part) is None):\n                         errors.append(\n                             checks.Error(\n                                 \"'ordering' refers to the nonexistent field, \"\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-12858/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-12965", "model_patch": "--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -1423,7 +1423,9 @@\n         Create the SQL for this query. Return the SQL string and list of\n         parameters.\n         \"\"\"\n-        if self.single_alias:\n+        # For full table deletions (no WHERE conditions and no joins),\n+        # use the simple DELETE FROM approach instead of subquery\n+        if self.single_alias and not self.query.where:\n             return self._as_sql(self.query)\n         innerq = self.query.clone()\n         innerq.__class__ = Query\n", "leaf_id": 11, "source_tree_path": "tmp/trajectory/django__django-12965/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13012", "model_patch": "--- a/django/db/models/expressions.py\n+++ b/django/db/models/expressions.py\n@@ -866,6 +866,9 @@\n     def as_sql(self, compiler, connection):\n         return self.expression.as_sql(compiler, connection)\n \n+    def get_group_by_cols(self, alias=None):\n+        return self.expression.get_group_by_cols(alias)\n+\n     def __repr__(self):\n         return \"{}({})\".format(self.__class__.__name__, self.expression)\n \n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-13012/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13023", "model_patch": "--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -1501,7 +1501,7 @@\n             return self.context.create_decimal_from_float(value)\n         try:\n             return decimal.Decimal(value)\n-        except decimal.InvalidOperation:\n+        except (decimal.InvalidOperation, TypeError):\n             raise exceptions.ValidationError(\n                 self.error_messages['invalid'],\n                 code='invalid',\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13023/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13028", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1124,11 +1124,12 @@\n \n     def check_filterable(self, expression):\n         \"\"\"Raise an error if expression cannot be used in a WHERE clause.\"\"\"\n-        if not getattr(expression, 'filterable', True):\n-            raise NotSupportedError(\n-                expression.__class__.__name__ + ' is disallowed in the filter '\n-                'clause.'\n-            )\n+        if hasattr(expression, 'filterable') and isinstance(expression, BaseExpression):\n+            if not getattr(expression, 'filterable', True):\n+                raise NotSupportedError(\n+                    expression.__class__.__name__ + ' is disallowed in the filter '\n+                    'clause.'\n+                )\n         if hasattr(expression, 'get_source_expressions'):\n             for expr in expression.get_source_expressions():\n                 self.check_filterable(expr)\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-13028/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13089", "model_patch": "--- a/django/core/cache/backends/db.py\n+++ b/django/core/cache/backends/db.py\n@@ -267,9 +267,11 @@\n                 cursor.execute(\n                     connection.ops.cache_key_culling_sql() % table,\n                     [cull_num])\n-                cursor.execute(\"DELETE FROM %s \"\n-                               \"WHERE cache_key < %%s\" % table,\n-                               [cursor.fetchone()[0]])\n+                result = cursor.fetchone()\n+                if result is not None:\n+                    cursor.execute(\"DELETE FROM %s \"\n+                                   \"WHERE cache_key < %%s\" % table,\n+                                   [result[0]])\n \n     def clear(self):\n         db = router.db_for_write(self.cache_model_class)\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13089/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13109", "model_patch": "--- a/django/db/models/fields/related.py\n+++ b/django/db/models/fields/related.py\n@@ -914,7 +914,7 @@\n             return\n \n         using = router.db_for_read(self.remote_field.model, instance=model_instance)\n-        qs = self.remote_field.model._default_manager.using(using).filter(\n+        qs = self.remote_field.model._base_manager.using(using).filter(\n             **{self.remote_field.field_name: value}\n         )\n         qs = qs.complex_filter(self.get_limit_choices_to())\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13109/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13121", "model_patch": "--- a/django/db/backends/sqlite3/operations.py\n+++ b/django/db/backends/sqlite3/operations.py\n@@ -271,6 +271,8 @@\n             converters.append(self.convert_timefield_value)\n         elif internal_type == 'DecimalField':\n             converters.append(self.get_decimalfield_converter(expression))\n+        elif internal_type == 'DurationField':\n+            converters.append(self.convert_durationfield_value)\n         elif internal_type == 'UUIDField':\n             converters.append(self.convert_uuidfield_value)\n         elif internal_type in ('NullBooleanField', 'BooleanField'):\n\n--- a/django/db/backends/mysql/operations.py\n+++ b/django/db/backends/mysql/operations.py\n@@ -296,6 +296,8 @@\n         elif internal_type == 'DateTimeField':\n             if settings.USE_TZ:\n                 converters.append(self.convert_datetimefield_value)\n+        elif internal_type == 'DurationField':\n+            converters.append(self.convert_durationfield_value)\n         elif internal_type == 'UUIDField':\n             converters.append(self.convert_uuidfield_value)\n         return converters\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-13121/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13158", "model_patch": "--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -437,7 +437,7 @@\n             for query in self.query.combined_queries if not query.is_empty()\n         ]\n         if not features.supports_slicing_ordering_in_compound:\n-            for query, compiler in zip(self.query.combined_queries, compilers):\n+            for query, compiler in zip([q for q in self.query.combined_queries if not q.is_empty()], compilers):\n                 if query.low_mark or query.high_mark:\n                     raise DatabaseError('LIMIT/OFFSET not allowed in subqueries of compound statements.')\n                 if compiler.get_order_by():\n", "leaf_id": 13, "source_tree_path": "tmp/trajectory/django__django-13158/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13195", "model_patch": "--- a/django/http/response.py\n+++ b/django/http/response.py\n@@ -210,13 +210,13 @@\n         value = signing.get_cookie_signer(salt=key + salt).sign(value)\n         return self.set_cookie(key, value, **kwargs)\n \n-    def delete_cookie(self, key, path='/', domain=None):\n+    def delete_cookie(self, key, path='/', domain=None, samesite=None):\n         # Most browsers ignore the Set-Cookie header if the cookie name starts\n         # with __Host- or __Secure- and the cookie doesn't use the secure flag.\n         secure = key.startswith(('__Secure-', '__Host-'))\n         self.set_cookie(\n             key, max_age=0, path=path, domain=domain, secure=secure,\n-            expires='Thu, 01 Jan 1970 00:00:00 GMT',\n+            expires='Thu, 01 Jan 1970 00:00:00 GMT', samesite=samesite,\n         )\n \n     # Common methods used by subclasses\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-13195/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13279", "model_patch": "--- a/django/contrib/sessions/backends/base.py\n+++ b/django/contrib/sessions/backends/base.py\n@@ -108,6 +108,13 @@\n \n     def encode(self, session_dict):\n         \"Return the given session dictionary serialized and encoded as a string.\"\n+        # RemovedInDjango40Warning: when the deprecation ends, remove the\n+        # legacy format.\n+        if settings.DEFAULT_HASHING_ALGORITHM == 'sha1':\n+            # Use legacy format for backward compatibility\n+            serialized = self.serializer().dumps(session_dict)\n+            hash = self._hash(serialized)\n+            return base64.b64encode(hash.encode() + b':' + serialized).decode('ascii')\n         return signing.dumps(\n             session_dict, salt=self.key_salt, serializer=self.serializer,\n             compress=True,\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-13279/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13297", "model_patch": "--- a/django/views/generic/base.py\n+++ b/django/views/generic/base.py\n@@ -166,10 +166,24 @@\n \n # RemovedInDjango40Warning\n def _wrap_url_kwargs_with_deprecation_warning(url_kwargs):\n+    class DeprecatedUrlKwargProxy(SimpleLazyObject):\n+        \"\"\"A SimpleLazyObject that ensures database compatibility.\"\"\"\n+        \n+        def __str__(self):\n+            # Ensure the lazy object resolves to a string for database operations\n+            return str(self._wrapped if self._wrapped is not None else self.func())\n+        \n+        def __eq__(self, other):\n+            # Ensure proper equality comparison for database lookups\n+            return str(self) == str(other)\n+        \n+        def __hash__(self):\n+            # Ensure proper hashing for database operations\n+            return hash(str(self))\n+    \n     context_kwargs = {}\n     for key, value in url_kwargs.items():\n         # Bind into function closure.\n-        @SimpleLazyObject\n         def access_value(key=key, value=value):\n             warnings.warn(\n                 'TemplateView passing URL kwargs to the context is '\n@@ -178,7 +192,7 @@\n                 RemovedInDjango40Warning, stacklevel=2,\n             )\n             return value\n-        context_kwargs[key] = access_value\n+        context_kwargs[key] = DeprecatedUrlKwargProxy(access_value)\n     return context_kwargs\n \n \n", "leaf_id": 10, "source_tree_path": "tmp/trajectory/django__django-13297/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13315", "model_patch": "--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -880,7 +880,7 @@\n             if hasattr(self.remote_field, 'get_related_field')\n             else 'pk'\n         )\n-        qs = rel_model._default_manager.complex_filter(limit_choices_to)\n+        qs = rel_model._default_manager.complex_filter(limit_choices_to).distinct()\n         if ordering:\n             qs = qs.order_by(*ordering)\n         return (blank_choice if include_blank else []) + [\n", "leaf_id": 17, "source_tree_path": "tmp/trajectory/django__django-13315/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13343", "model_patch": "--- a/django/db/models/fields/files.py\n+++ b/django/db/models/fields/files.py\n@@ -227,6 +227,9 @@\n     def __init__(self, verbose_name=None, name=None, upload_to='', storage=None, **kwargs):\n         self._primary_key_set_explicitly = 'primary_key' in kwargs\n \n+        # Store the original storage parameter for deconstruction\n+        self._storage_parameter = storage\n+        \n         self.storage = storage or default_storage\n         if callable(self.storage):\n             self.storage = self.storage()\n@@ -278,8 +281,8 @@\n         if kwargs.get(\"max_length\") == 100:\n             del kwargs[\"max_length\"]\n         kwargs['upload_to'] = self.upload_to\n-        if self.storage is not default_storage:\n-            kwargs['storage'] = self.storage\n+        if self._storage_parameter is not None:\n+            kwargs['storage'] = self._storage_parameter\n         return name, path, args, kwargs\n \n     def get_internal_type(self):\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-13343/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13344", "model_patch": "--- a/django/utils/deprecation.py\n+++ b/django/utils/deprecation.py\n@@ -131,6 +131,9 @@\n                 thread_sensitive=True,\n             )(request)\n         response = response or await self.get_response(request)\n+        # Make sure the response is not a coroutine\n+        if asyncio.iscoroutine(response):\n+            response = await response\n         if hasattr(self, 'process_response'):\n             response = await sync_to_async(\n                 self.process_response,\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-13344/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13346", "model_patch": "--- a/django/db/models/fields/json.py\n+++ b/django/db/models/fields/json.py\n@@ -455,6 +455,10 @@\n     pass\n \n \n+class KeyTransformIn(KeyTransformTextLookupMixin, lookups.In):\n+    pass\n+\n+\n class KeyTransformNumericLookupMixin:\n     def process_rhs(self, compiler, connection):\n         rhs, rhs_params = super().process_rhs(compiler, connection)\n@@ -482,6 +486,7 @@\n KeyTransform.register_lookup(KeyTransformExact)\n KeyTransform.register_lookup(KeyTransformIExact)\n KeyTransform.register_lookup(KeyTransformIsNull)\n+KeyTransform.register_lookup(KeyTransformIn)\n KeyTransform.register_lookup(KeyTransformIContains)\n KeyTransform.register_lookup(KeyTransformStartsWith)\n KeyTransform.register_lookup(KeyTransformIStartsWith)\n", "leaf_id": 17, "source_tree_path": "tmp/trajectory/django__django-13346/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13363", "model_patch": "--- a/django/db/models/functions/datetime.py\n+++ b/django/db/models/functions/datetime.py\n@@ -292,7 +292,7 @@\n     def as_sql(self, compiler, connection):\n         # Cast to date rather than truncate to date.\n         lhs, lhs_params = compiler.compile(self.lhs)\n-        tzname = timezone.get_current_timezone_name() if settings.USE_TZ else None\n+        tzname = self.get_tzname()\n         sql = connection.ops.datetime_cast_date_sql(lhs, tzname)\n         return sql, lhs_params\n \n@@ -305,7 +305,7 @@\n     def as_sql(self, compiler, connection):\n         # Cast to time rather than truncate to time.\n         lhs, lhs_params = compiler.compile(self.lhs)\n-        tzname = timezone.get_current_timezone_name() if settings.USE_TZ else None\n+        tzname = self.get_tzname()\n         sql = connection.ops.datetime_cast_time_sql(lhs, tzname)\n         return sql, lhs_params\n \n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-13363/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13406", "model_patch": "--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -196,6 +196,10 @@\n         self._prefetch_done = False\n         self._known_related_objects = {}  # {rel_field: {pk: rel_obj}}\n         self._iterable_class = ModelIterable\n+        # If the query has values_select populated (e.g., from a pickled query\n+        # that was created with values()), set the appropriate iterable class\n+        if self._query.values_select:\n+            self._iterable_class = ValuesIterable\n         self._fields = None\n         self._defer_next_filter = False\n         self._deferred_filter = None\n", "leaf_id": 11, "source_tree_path": "tmp/trajectory/django__django-13406/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13410", "model_patch": "--- a/django/core/files/locks.py\n+++ b/django/core/files/locks.py\n@@ -107,9 +107,15 @@\n             return True\n     else:\n         def lock(f, flags):\n-            ret = fcntl.flock(_fd(f), flags)\n-            return ret == 0\n+            try:\n+                fcntl.flock(_fd(f), flags)\n+                return True\n+            except OSError:\n+                return False\n \n         def unlock(f):\n-            ret = fcntl.flock(_fd(f), fcntl.LOCK_UN)\n-            return ret == 0\n+            try:\n+                fcntl.flock(_fd(f), fcntl.LOCK_UN)\n+                return True\n+            except OSError:\n+                return False\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13410/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13417", "model_patch": "--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -1225,7 +1225,9 @@\n         if self.query.extra_order_by or self.query.order_by:\n             return True\n         elif self.query.default_ordering and self.query.get_meta().ordering:\n-            return True\n+            # GROUP BY queries suppress default ordering, so only return True\n+            # if there's no GROUP BY clause\n+            return self.query.group_by is None\n         else:\n             return False\n \n", "leaf_id": 15, "source_tree_path": "tmp/trajectory/django__django-13417/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13449", "model_patch": "--- a/django/db/models/expressions.py\n+++ b/django/db/models/expressions.py\n@@ -1332,6 +1332,23 @@\n             'window': ''.join(window_sql).strip()\n         }, params\n \n+    def as_sqlite(self, compiler, connection, **extra_context):\n+        # For SQLite, if the source expression has a DecimalField output_field,\n+        # we need to wrap the entire window expression with CAST(...AS NUMERIC)\n+        # instead of letting the source expression apply the cast prematurely.\n+        try:\n+            if self.source_expression.output_field.get_internal_type() == 'DecimalField':\n+                # Get the SQL without any casting from the source expression\n+                # We'll apply the cast to the entire window expression\n+                sql, params = self.as_sql(compiler, connection, **extra_context)\n+                return 'CAST(%s AS NUMERIC)' % sql, params\n+        except (AttributeError, FieldError):\n+            # If there's no output_field or it's not accessible, fall back to default\n+            pass\n+        \n+        # Default behavior for non-DecimalField expressions\n+        return self.as_sql(compiler, connection, **extra_context)\n+\n     def __str__(self):\n         return '{} OVER ({}{}{})'.format(\n             str(self.source_expression),\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-13449/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13512", "model_patch": "--- a/django/forms/fields.py\n+++ b/django/forms/fields.py\n@@ -1258,7 +1258,7 @@\n     def prepare_value(self, value):\n         if isinstance(value, InvalidJSONInput):\n             return value\n-        return json.dumps(value, cls=self.encoder)\n+        return json.dumps(value, ensure_ascii=False, cls=self.encoder)\n \n     def has_changed(self, initial, data):\n         if super().has_changed(initial, data):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13512/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13516", "model_patch": "--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -149,6 +149,10 @@\n             msg += ending\n         style_func = style_func or self.style_func\n         self._out.write(style_func(msg))\n+\n+    def flush(self):\n+        if hasattr(self._out, 'flush'):\n+            self._out.flush()\n \n \n class BaseCommand:\n", "leaf_id": 13, "source_tree_path": "tmp/trajectory/django__django-13516/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13551", "model_patch": "--- a/django/contrib/auth/tokens.py\n+++ b/django/contrib/auth/tokens.py\n@@ -85,6 +85,7 @@\n            same password is chosen, due to password salting).\n         2. The last_login field will usually be updated very shortly after\n            a password reset.\n+        3. The email field will change when the user's email is updated.\n         Failing those things, settings.PASSWORD_RESET_TIMEOUT eventually\n         invalidates the token.\n \n@@ -94,7 +95,9 @@\n         # Truncate microseconds so that tokens are consistent even if the\n         # database doesn't support microseconds.\n         login_timestamp = '' if user.last_login is None else user.last_login.replace(microsecond=0, tzinfo=None)\n-        return str(user.pk) + user.password + str(login_timestamp) + str(timestamp)\n+        email_field_name = user.get_email_field_name()\n+        email = getattr(user, email_field_name, None) or ''\n+        return str(user.pk) + user.password + str(login_timestamp) + str(email) + str(timestamp)\n \n     def _num_seconds(self, dt):\n         return int((dt - datetime(2001, 1, 1)).total_seconds())\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-13551/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13568", "model_patch": "--- a/django/contrib/auth/checks.py\n+++ b/django/contrib/auth/checks.py\n@@ -52,7 +52,19 @@\n         )\n \n     # Check that the username field is unique\n-    if not cls._meta.get_field(cls.USERNAME_FIELD).unique:\n+    username_field_unique = cls._meta.get_field(cls.USERNAME_FIELD).unique\n+    \n+    # Check if USERNAME_FIELD is covered by any UniqueConstraint\n+    username_in_unique_constraint = False\n+    for constraint in cls._meta.constraints:\n+        if (hasattr(constraint, 'fields') and \n+            hasattr(constraint, '__class__') and \n+            constraint.__class__.__name__ == 'UniqueConstraint' and\n+            cls.USERNAME_FIELD in constraint.fields):\n+            username_in_unique_constraint = True\n+            break\n+    \n+    if not username_field_unique and not username_in_unique_constraint:\n         if (settings.AUTHENTICATION_BACKENDS ==\n                 ['django.contrib.auth.backends.ModelBackend']):\n             errors.append(\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-13568/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13569", "model_patch": "--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -128,7 +128,7 @@\n         for expr, (sql, params, is_ref) in order_by:\n             # Skip References to the select clause, as all expressions in the\n             # select clause are already part of the group by.\n-            if not is_ref:\n+            if not is_ref and not isinstance(expr, Random):\n                 expressions.extend(expr.get_group_by_cols())\n         having_group_by = self.having.get_group_by_cols() if self.having else ()\n         for expr in having_group_by:\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-13569/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13590", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1077,10 +1077,10 @@\n         elif isinstance(value, (list, tuple)):\n             # The items of the iterable may be expressions and therefore need\n             # to be resolved independently.\n-            return type(value)(\n+            return type(value)(*[\n                 self.resolve_lookup_value(sub_value, can_reuse, allow_joins)\n                 for sub_value in value\n-            )\n+            ])\n         return value\n \n     def solve_lookup_type(self, lookup):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13590/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13658", "model_patch": "--- a/django/core/management/__init__.py\n+++ b/django/core/management/__init__.py\n@@ -344,7 +344,12 @@\n         # Preprocess options to extract --settings and --pythonpath.\n         # These options could affect the commands that are available, so they\n         # must be processed early.\n-        parser = CommandParser(usage='%(prog)s subcommand [options] [args]', add_help=False, allow_abbrev=False)\n+        parser = CommandParser(\n+            prog=self.prog_name,\n+            usage='%(prog)s subcommand [options] [args]',\n+            add_help=False,\n+            allow_abbrev=False\n+        )\n         parser.add_argument('--settings')\n         parser.add_argument('--pythonpath')\n         parser.add_argument('args', nargs='*')  # catch-all\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13658/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13670", "model_patch": "--- a/django/utils/dateformat.py\n+++ b/django/utils/dateformat.py\n@@ -326,7 +326,7 @@\n \n     def y(self):\n         \"Year, 2 digits; e.g. '99'\"\n-        return str(self.data.year)[2:]\n+        return '%02d' % (self.data.year % 100)\n \n     def Y(self):\n         \"Year, 4 digits; e.g. '1999'\"\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13670/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13741", "model_patch": "--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -56,6 +56,7 @@\n \n     def __init__(self, *args, **kwargs):\n         kwargs.setdefault(\"required\", False)\n+        kwargs.setdefault('disabled', True)\n         super().__init__(*args, **kwargs)\n \n     def bound_data(self, data, initial):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13741/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13786", "model_patch": "--- a/django/db/migrations/operations/models.py\n+++ b/django/db/migrations/operations/models.py\n@@ -137,11 +137,15 @@\n                 ),\n             ]\n         elif isinstance(operation, AlterModelOptions) and self.name_lower == operation.name_lower:\n+            options = {**self.options, **operation.options}\n+            for key in operation.ALTER_OPTION_KEYS:\n+                if key not in operation.options:\n+                    options.pop(key, False)\n             return [\n                 CreateModel(\n                     self.name,\n                     fields=self.fields,\n-                    options={**self.options, **operation.options},\n+                    options=options,\n                     bases=self.bases,\n                     managers=self.managers,\n                 ),\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-13786/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13794", "model_patch": "--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -10,7 +10,7 @@\n \n from django.utils import formats\n from django.utils.dateformat import format, time_format\n-from django.utils.encoding import iri_to_uri\n+from django.utils.encoding import force_str, iri_to_uri\n from django.utils.html import (\n     avoid_wrapping, conditional_escape, escape, escapejs,\n     json_script as _json_script, linebreaks, strip_tags, urlize as _urlize,\n@@ -678,7 +678,7 @@\n         return int(value) + int(arg)\n     except (ValueError, TypeError):\n         try:\n-            return value + arg\n+            return force_str(value) + force_str(arg)\n         except Exception:\n             return ''\n \n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-13794/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13807", "model_patch": "--- a/django/db/backends/sqlite3/base.py\n+++ b/django/db/backends/sqlite3/base.py\n@@ -327,19 +327,21 @@\n                     violations = cursor.execute('PRAGMA foreign_key_check').fetchall()\n                 else:\n                     violations = chain.from_iterable(\n-                        cursor.execute('PRAGMA foreign_key_check(%s)' % table_name).fetchall()\n+                        cursor.execute('PRAGMA foreign_key_check(%s)' % self.ops.quote_name(table_name)).fetchall()\n                         for table_name in table_names\n                     )\n                 # See https://www.sqlite.org/pragma.html#pragma_foreign_key_check\n                 for table_name, rowid, referenced_table_name, foreign_key_index in violations:\n                     foreign_key = cursor.execute(\n-                        'PRAGMA foreign_key_list(%s)' % table_name\n+                        'PRAGMA foreign_key_list(%s)' % self.ops.quote_name(table_name)\n                     ).fetchall()[foreign_key_index]\n                     column_name, referenced_column_name = foreign_key[3:5]\n                     primary_key_column_name = self.introspection.get_primary_key_column(cursor, table_name)\n                     primary_key_value, bad_value = cursor.execute(\n                         'SELECT %s, %s FROM %s WHERE rowid = %%s' % (\n-                            primary_key_column_name, column_name, table_name\n+                            self.ops.quote_name(primary_key_column_name), \n+                            self.ops.quote_name(column_name), \n+                            self.ops.quote_name(table_name)\n                         ),\n                         (rowid,),\n                     ).fetchone()\n", "leaf_id": 13, "source_tree_path": "tmp/trajectory/django__django-13807/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13809", "model_patch": "--- a/django/core/management/commands/runserver.py\n+++ b/django/core/management/commands/runserver.py\n@@ -50,6 +50,10 @@\n         parser.add_argument(\n             '--noreload', action='store_false', dest='use_reloader',\n             help='Tells Django to NOT use the auto-reloader.',\n+        )\n+        parser.add_argument(\n+            '--skip-checks', action='store_true', dest='skip_checks',\n+            help='Tells Django to skip system checks.',\n         )\n \n     def execute(self, *args, **options):\n", "leaf_id": 15, "source_tree_path": "tmp/trajectory/django__django-13809/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13810", "model_patch": "--- a/django/core/handlers/base.py\n+++ b/django/core/handlers/base.py\n@@ -49,6 +49,9 @@\n                 middleware_is_async = False\n             else:\n                 middleware_is_async = middleware_can_async\n+            # Store original handler state before attempting to adapt\n+            original_handler = handler\n+            original_handler_is_async = handler_is_async\n             try:\n                 # Adapt handler, if needed.\n                 handler = self.adapt_method_mode(\n@@ -57,6 +60,9 @@\n                 )\n                 mw_instance = middleware(handler)\n             except MiddlewareNotUsed as exc:\n+                # Restore original handler state when middleware is not used\n+                handler = original_handler\n+                handler_is_async = original_handler_is_async\n                 if settings.DEBUG:\n                     if str(exc):\n                         logger.debug('MiddlewareNotUsed(%r): %s', middleware_path, exc)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-13810/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13820", "model_patch": "--- a/django/db/migrations/loader.py\n+++ b/django/db/migrations/loader.py\n@@ -90,7 +90,7 @@\n             else:\n                 # Empty directories are namespaces.\n                 # getattr() needed on PY36 and older (replace w/attribute access).\n-                if getattr(module, '__file__', None) is None:\n+                if getattr(module, '__file__', None) is None and not isinstance(getattr(module, '__path__', None), list):\n                     self.unmigrated_apps.add(app_config.label)\n                     continue\n                 # Module is not a package (e.g. migrations.py).\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13820/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13821", "model_patch": "--- a/django/db/backends/sqlite3/base.py\n+++ b/django/db/backends/sqlite3/base.py\n@@ -64,8 +64,8 @@\n \n \n def check_sqlite_version():\n-    if Database.sqlite_version_info < (3, 8, 3):\n-        raise ImproperlyConfigured('SQLite 3.8.3 or later is required (found %s).' % Database.sqlite_version)\n+    if Database.sqlite_version_info < (3, 9, 0):\n+        raise ImproperlyConfigured('SQLite 3.9.0 or later is required (found %s).' % Database.sqlite_version)\n \n \n check_sqlite_version()\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-13821/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13837", "model_patch": "--- a/django/utils/autoreload.py\n+++ b/django/utils/autoreload.py\n@@ -221,10 +221,14 @@\n     py_script = Path(sys.argv[0])\n \n     args = [sys.executable] + ['-W%s' % o for o in sys.warnoptions]\n-    if py_script == django_main_path:\n-        # The server was started with `python -m django runserver`.\n-        args += ['-m', 'django']\n-        args += sys.argv[1:]\n+    # Check if Python was launched with -m using the documented approach\n+    if hasattr(__import__('__main__'), '__spec__') and __import__('__main__').__spec__ is not None:\n+        # Python was launched with -m, get the package name\n+        main_spec = __import__('__main__').__spec__\n+        if main_spec.parent:\n+            # The server was started with `python -m <package> runserver`.\n+            args += ['-m', main_spec.parent]\n+            args += sys.argv[1:]\n     elif not py_script.exists():\n         # sys.argv[0] may not exist for several reasons on Windows.\n         # It may exist with a .exe extension or have a -script.py suffix.\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-13837/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13925", "model_patch": "--- a/django/db/models/base.py\n+++ b/django/db/models/base.py\n@@ -1302,6 +1302,17 @@\n             not settings.is_overridden('DEFAULT_AUTO_FIELD') and\n             not cls._meta.app_config._is_default_auto_field_overridden\n         ):\n+            # Check if the primary key was inherited from a parent model\n+            # that had a manually specified primary key\n+            pk_name = cls._meta.pk.name\n+            for parent in cls._meta.get_parent_list():\n+                if hasattr(parent, '_meta') and parent._meta.pk:\n+                    parent_pk = parent._meta.pk\n+                    # If parent has the same primary key name and it's not auto_created,\n+                    # then this model inherited a manually specified primary key\n+                    if parent_pk.name == pk_name and not parent_pk.auto_created:\n+                        return []\n+            \n             return [\n                 checks.Warning(\n                     f\"Auto-created primary key used when not defining a \"\n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-13925/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13933", "model_patch": "--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -1188,7 +1188,7 @@\n     # This class is a subclass of ChoiceField for purity, but it doesn't\n     # actually use any of ChoiceField's implementation.\n     default_error_messages = {\n-        'invalid_choice': _('Select a valid choice. That choice is not one of'\n+        'invalid_choice': _('Select a valid choice. %(value)s is not one of'\n                             ' the available choices.'),\n     }\n     iterator = ModelChoiceIterator\n@@ -1278,13 +1278,18 @@\n     def to_python(self, value):\n         if value in self.empty_values:\n             return None\n+        original_value = value\n         try:\n             key = self.to_field_name or 'pk'\n             if isinstance(value, self.queryset.model):\n                 value = getattr(value, key)\n             value = self.queryset.get(**{key: value})\n         except (ValueError, TypeError, self.queryset.model.DoesNotExist):\n-            raise ValidationError(self.error_messages['invalid_choice'], code='invalid_choice')\n+            raise ValidationError(\n+                self.error_messages['invalid_choice'],\n+                code='invalid_choice',\n+                params={'value': original_value},\n+            )\n         return value\n \n     def validate(self, value):\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-13933/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-13964", "model_patch": "--- a/django/db/models/fields/related_descriptors.py\n+++ b/django/db/models/fields/related_descriptors.py\n@@ -254,7 +254,18 @@\n         # Set the values of the related field.\n         else:\n             for lh_field, rh_field in self.field.related_fields:\n-                setattr(instance, lh_field.attname, getattr(value, rh_field.attname))\n+                rh_value = getattr(value, rh_field.attname)\n+                # If the related object's primary key is empty/None, defer the assignment\n+                # by storing a reference to the related object instead of copying the empty value\n+                if rh_value in (None, ''):\n+                    # Store a reference to the related object for deferred assignment\n+                    setattr(instance, '_deferred_' + lh_field.attname, value)\n+                    # Don't set the foreign key field yet\n+                else:\n+                    setattr(instance, lh_field.attname, rh_value)\n+                    # Clear any deferred reference if we have a valid value\n+                    if hasattr(instance, '_deferred_' + lh_field.attname):\n+                        delattr(instance, '_deferred_' + lh_field.attname)\n \n         # Set the related instance cache used by __get__ to avoid an SQL query\n         # when accessing the attribute we just set.\n\n--- a/django/db/models/base.py\n+++ b/django/db/models/base.py\n@@ -909,6 +909,21 @@\n         )\n \n     def _prepare_related_fields_for_save(self, operation_name):\n+        # First, resolve any deferred foreign key assignments\n+        for field in self._meta.concrete_fields:\n+            if field.is_relation:\n+                deferred_attr = '_deferred_' + field.attname\n+                if hasattr(self, deferred_attr):\n+                    # Get the related object from the deferred assignment\n+                    related_obj = getattr(self, deferred_attr)\n+                    if related_obj is not None:\n+                        # Check if the related object now has a primary key\n+                        pk_value = getattr(related_obj, field.target_field.attname)\n+                        if pk_value not in (None, ''):\n+                            # Set the foreign key field and remove the deferred assignment\n+                            setattr(self, field.attname, pk_value)\n+                            delattr(self, deferred_attr)\n+        \n         # Ensure that a model instance without a PK hasn't been assigned to\n         # a ForeignKey or OneToOneField on this model. If the field is\n         # nullable, allowing the save would result in silent data loss.\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-13964/2025-11-27_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14007", "model_patch": "--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -1412,13 +1412,22 @@\n             if not self.returning_fields:\n                 return []\n             if self.connection.features.can_return_rows_from_bulk_insert and len(self.query.objs) > 1:\n-                return self.connection.ops.fetch_returned_insert_rows(cursor)\n-            if self.connection.features.can_return_columns_from_insert:\n+                rows = self.connection.ops.fetch_returned_insert_rows(cursor)\n+            elif self.connection.features.can_return_columns_from_insert:\n                 assert len(self.query.objs) == 1\n-                return [self.connection.ops.fetch_returned_insert_columns(cursor, self.returning_params)]\n-            return [(self.connection.ops.last_insert_id(\n-                cursor, self.query.get_meta().db_table, self.query.get_meta().pk.column\n-            ),)]\n+                rows = [self.connection.ops.fetch_returned_insert_columns(cursor, self.returning_params)]\n+            else:\n+                rows = [(self.connection.ops.last_insert_id(\n+                    cursor, self.query.get_meta().db_table, self.query.get_meta().pk.column\n+                ),)]\n+            \n+            # Apply converters to the returned values\n+            if self.returning_fields:\n+                converters = self.get_converters(self.returning_fields)\n+                if converters:\n+                    rows = list(self.apply_converters(rows, converters))\n+            \n+            return rows\n \n \n class SQLDeleteCompiler(SQLCompiler):\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-14007/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14011", "model_patch": "--- a/django/core/servers/basehttp.py\n+++ b/django/core/servers/basehttp.py\n@@ -80,6 +80,27 @@\n class ThreadedWSGIServer(socketserver.ThreadingMixIn, WSGIServer):\n     \"\"\"A threaded version of the WSGIServer\"\"\"\n     daemon_threads = True\n+\n+    def process_request(self, request, client_address):\n+        \"\"\"Start a new thread to process the request.\"\"\"\n+        from django.db import connections\n+        \n+        def process_request_thread():\n+            try:\n+                self.finish_request(request, client_address)\n+            except Exception:\n+                self.handle_error(request, client_address)\n+            finally:\n+                # Close database connections to prevent connection leaks\n+                connections.close_all()\n+                self.shutdown_request(request)\n+        \n+        import threading\n+        t = threading.Thread(target=process_request_thread)\n+        t.daemon = self.daemon_threads\n+        if not t.daemon:\n+            self.threads.append(t)\n+        t.start()\n \n \n class ServerHandler(simple_server.ServerHandler):\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-14011/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14017", "model_patch": "--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -63,6 +63,12 @@\n \n     def __and__(self, other):\n         return self._combine(other, self.AND)\n+\n+    def __rand__(self, other):\n+        return other & self\n+\n+    def __ror__(self, other):\n+        return other | self\n \n     def __invert__(self):\n         obj = type(self)()\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-14017/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14053", "model_patch": "--- a/django/contrib/staticfiles/storage.py\n+++ b/django/contrib/staticfiles/storage.py\n@@ -220,6 +220,8 @@\n \n         # where to store the new paths\n         hashed_files = {}\n+        # track which files have been yielded to prevent duplicates\n+        yielded_files = set()\n \n         # build a list of adjustable files\n         adjustable_paths = [\n@@ -229,14 +231,18 @@\n         # Do a single pass first. Post-process all files once, then repeat for\n         # adjustable files.\n         for name, hashed_name, processed, _ in self._post_process(paths, adjustable_paths, hashed_files):\n-            yield name, hashed_name, processed\n+            if name not in yielded_files:\n+                yielded_files.add(name)\n+                yield name, hashed_name, processed\n \n         paths = {path: paths[path] for path in adjustable_paths}\n \n         for i in range(self.max_post_process_passes):\n             substitutions = False\n             for name, hashed_name, processed, subst in self._post_process(paths, adjustable_paths, hashed_files):\n-                yield name, hashed_name, processed\n+                if name not in yielded_files:\n+                    yielded_files.add(name)\n+                    yield name, hashed_name, processed\n                 substitutions = substitutions or subst\n \n             if not substitutions:\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-14053/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14089", "model_patch": "--- a/django/utils/datastructures.py\n+++ b/django/utils/datastructures.py\n@@ -24,6 +24,9 @@\n \n     def __iter__(self):\n         return iter(self.dict)\n+\n+    def __reversed__(self):\n+        return reversed(self.dict)\n \n     def __contains__(self, item):\n         return item in self.dict\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-14089/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14122", "model_patch": "--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -129,6 +129,27 @@\n             # Skip References to the select clause, as all expressions in the\n             # select clause are already part of the group by.\n             if not is_ref:\n+                # Skip Meta.ordering fields from being added to GROUP BY\n+                if hasattr(self, '_meta_ordering') and self._meta_ordering:\n+                    # Check if this expression comes from Meta.ordering\n+                    is_meta_ordering = False\n+                    for meta_field in self._meta_ordering:\n+                        if hasattr(meta_field, 'resolve_expression'):\n+                            # For expression-based ordering (F(), OrderBy(), etc.)\n+                            try:\n+                                resolved_meta = meta_field.resolve_expression(self.query, allow_joins=True, reuse=None)\n+                                if resolved_meta == expr:\n+                                    is_meta_ordering = True\n+                                    break\n+                            except (FieldError, AttributeError):\n+                                continue\n+                        else:\n+                            # For string-based ordering, we need to compare with the field name\n+                            # This is more complex as we need to resolve the string to an expression\n+                            # and compare with the current expr\n+                            continue\n+                    if is_meta_ordering:\n+                        continue\n                 expressions.extend(expr.get_group_by_cols())\n         having_group_by = self.having.get_group_by_cols() if self.having else ()\n         for expr in having_group_by:\n", "leaf_id": 19, "source_tree_path": "tmp/trajectory/django__django-14122/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14140", "model_patch": "--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -87,7 +87,10 @@\n         args, kwargs = (), {}\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            if isinstance(child, tuple) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = tuple(self.children)\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-14140/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14155", "model_patch": "--- a/django/urls/resolvers.py\n+++ b/django/urls/resolvers.py\n@@ -45,12 +45,17 @@\n         self.namespaces = [x for x in namespaces if x] if namespaces else []\n         self.namespace = ':'.join(self.namespaces)\n \n-        if not hasattr(func, '__name__'):\n+        # Handle functools.partial for _func_path generation\n+        callback = func\n+        if isinstance(callback, functools.partial):\n+            callback = callback.func\n+        \n+        if not hasattr(callback, '__name__'):\n             # A class-based view\n-            self._func_path = func.__class__.__module__ + '.' + func.__class__.__name__\n+            self._func_path = callback.__class__.__module__ + '.' + callback.__class__.__name__\n         else:\n             # A function-based view\n-            self._func_path = func.__module__ + '.' + func.__name__\n+            self._func_path = callback.__module__ + '.' + callback.__name__\n \n         view_path = url_name or self._func_path\n         self.view_name = ':'.join(self.namespaces + [view_path])\n@@ -59,8 +64,14 @@\n         return (self.func, self.args, self.kwargs)[index]\n \n     def __repr__(self):\n+        if isinstance(self.func, functools.partial):\n+            func_repr = \"functools.partial(%s, *%r, **%r)\" % (\n+                self._func_path, self.func.args, self.func.keywords\n+            )\n+        else:\n+            func_repr = self._func_path\n         return \"ResolverMatch(func=%s, args=%s, kwargs=%s, url_name=%s, app_names=%s, namespaces=%s, route=%s)\" % (\n-            self._func_path, self.args, self.kwargs, self.url_name,\n+            func_repr, self.args, self.kwargs, self.url_name,\n             self.app_names, self.namespaces, self.route,\n         )\n \n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-14155/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14170", "model_patch": "--- a/django/db/models/functions/datetime.py\n+++ b/django/db/models/functions/datetime.py\n@@ -164,11 +164,7 @@\n ExtractYear.register_lookup(YearLt)\n ExtractYear.register_lookup(YearLte)\n \n-ExtractIsoYear.register_lookup(YearExact)\n-ExtractIsoYear.register_lookup(YearGt)\n-ExtractIsoYear.register_lookup(YearGte)\n-ExtractIsoYear.register_lookup(YearLt)\n-ExtractIsoYear.register_lookup(YearLte)\n+\n \n \n class Now(Func):\n", "leaf_id": 17, "source_tree_path": "tmp/trajectory/django__django-14170/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14238", "model_patch": "--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -2524,7 +2524,7 @@\n         return isinstance(instance, self._subclasses) or super().__instancecheck__(instance)\n \n     def __subclasscheck__(self, subclass):\n-        return subclass in self._subclasses or super().__subclasscheck__(subclass)\n+        return any(issubclass(subclass, cls) for cls in self._subclasses) or super().__subclasscheck__(subclass)\n \n \n class AutoField(AutoFieldMixin, IntegerField, metaclass=AutoFieldMeta):\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-14238/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14311", "model_patch": "--- a/django/utils/autoreload.py\n+++ b/django/utils/autoreload.py\n@@ -224,7 +224,7 @@\n     # see https://docs.python.org/3/reference/import.html#main-spec\n     # __spec__ may not exist, e.g. when running in a Conda env.\n     if getattr(__main__, '__spec__', None) is not None and __main__.__spec__.parent:\n-        args += ['-m', __main__.__spec__.parent]\n+        args += ['-m', __main__.__spec__.name]\n         args += sys.argv[1:]\n     elif not py_script.exists():\n         # sys.argv[0] may not exist for several reasons on Windows.\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-14311/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14315", "model_patch": "--- a/django/db/backends/postgresql/client.py\n+++ b/django/db/backends/postgresql/client.py\n@@ -51,7 +51,7 @@\n             env['PGSSLKEY'] = str(sslkey)\n         if passfile:\n             env['PGPASSFILE'] = str(passfile)\n-        return args, env\n+        return args, env or None\n \n     def runshell(self, parameters):\n         sigint_handler = signal.getsignal(signal.SIGINT)\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-14315/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14351", "model_patch": "--- a/django/db/models/fields/related_lookups.py\n+++ b/django/db/models/fields/related_lookups.py\n@@ -86,7 +86,9 @@\n                     AND)\n             return root_constraint.as_sql(compiler, connection)\n         else:\n-            if (not getattr(self.rhs, 'has_select_fields', True) and\n+            # For QuerySet objects, always clear the select clause and add only the target field\n+            # to avoid \"subquery must return only one column\" errors in OR'd Q object contexts\n+            if (hasattr(self.rhs, 'model') and hasattr(self.rhs, 'query') and\n                     not getattr(self.lhs.field.target_field, 'primary_key', False)):\n                 self.rhs.clear_select_clause()\n                 if (getattr(self.lhs.output_field, 'primary_key', False) and\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-14351/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14373", "model_patch": "--- a/django/utils/dateformat.py\n+++ b/django/utils/dateformat.py\n@@ -314,7 +314,7 @@\n \n     def Y(self):\n         \"Year, 4 digits; e.g. '1999'\"\n-        return self.data.year\n+        return '%04d' % self.data.year\n \n     def z(self):\n         \"\"\"Day of the year, i.e. 1 to 366.\"\"\"\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-14373/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14376", "model_patch": "--- a/django/db/backends/mysql/base.py\n+++ b/django/db/backends/mysql/base.py\n@@ -200,9 +200,9 @@\n         if settings_dict['USER']:\n             kwargs['user'] = settings_dict['USER']\n         if settings_dict['NAME']:\n-            kwargs['db'] = settings_dict['NAME']\n+            kwargs['database'] = settings_dict['NAME']\n         if settings_dict['PASSWORD']:\n-            kwargs['passwd'] = settings_dict['PASSWORD']\n+            kwargs['password'] = settings_dict['PASSWORD']\n         if settings_dict['HOST'].startswith('/'):\n             kwargs['unix_socket'] = settings_dict['HOST']\n         elif settings_dict['HOST']:\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-14376/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14404", "model_patch": "--- a/django/contrib/admin/sites.py\n+++ b/django/contrib/admin/sites.py\n@@ -420,7 +420,7 @@\n     def catch_all_view(self, request, url):\n         if settings.APPEND_SLASH and not url.endswith('/'):\n             urlconf = getattr(request, 'urlconf', None)\n-            path = '%s/' % request.path_info\n+            path = '%s/' % request.path\n             try:\n                 match = resolve(path, urlconf)\n             except Resolver404:\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-14404/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14434", "model_patch": "--- a/django/db/backends/base/schema.py\n+++ b/django/db/backends/base/schema.py\n@@ -1251,7 +1251,7 @@\n         else:\n             sql = self.sql_create_unique\n         if columns:\n-            columns = self._index_columns(table, columns, col_suffixes=(), opclasses=opclasses)\n+            columns = self._index_columns(table.table, columns, col_suffixes=(), opclasses=opclasses)\n         else:\n             columns = Expressions(model._meta.db_table, expressions, compiler, self.quote_value)\n         return Statement(\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-14434/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14493", "model_patch": "--- a/django/contrib/staticfiles/storage.py\n+++ b/django/contrib/staticfiles/storage.py\n@@ -261,6 +261,7 @@\n \n         paths = {path: paths[path] for path in adjustable_paths}\n \n+        substitutions = False\n         for i in range(self.max_post_process_passes):\n             substitutions = False\n             for name, hashed_name, processed, subst in self._post_process(paths, adjustable_paths, hashed_files):\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-14493/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14500", "model_patch": "--- a/django/db/migrations/executor.py\n+++ b/django/db/migrations/executor.py\n@@ -254,6 +254,14 @@\n         if migration.replaces:\n             for app_label, name in migration.replaces:\n                 self.recorder.record_unapplied(app_label, name)\n+            # Only mark the squashed migration as unapplied if the replaced\n+            # migration files don't exist on disk\n+            replaced_migrations_on_disk = any(\n+                (app_label, name) in self.loader.disk_migrations\n+                for app_label, name in migration.replaces\n+            )\n+            if not replaced_migrations_on_disk:\n+                self.recorder.record_unapplied(migration.app_label, migration.name)\n         else:\n             self.recorder.record_unapplied(migration.app_label, migration.name)\n         # Report progress\n", "leaf_id": 8, "source_tree_path": "tmp/trajectory/django__django-14500/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14534", "model_patch": "--- a/django/forms/boundfield.py\n+++ b/django/forms/boundfield.py\n@@ -277,7 +277,7 @@\n \n     @property\n     def id_for_label(self):\n-        return 'id_%s_%s' % (self.data['name'], self.data['index'])\n+        return self.data['attrs']['id']\n \n     @property\n     def choice_label(self):\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-14534/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14539", "model_patch": "--- a/django/utils/html.py\n+++ b/django/utils/html.py\n@@ -284,7 +284,7 @@\n             stripped = middle_unescaped.rstrip(TRAILING_PUNCTUATION_CHARS)\n             if middle_unescaped != stripped:\n                 trail = middle[len(stripped):] + trail\n-                middle = middle[:len(stripped) - len(middle_unescaped)]\n+                middle = middle[:len(stripped)]\n                 trimmed_something = True\n         return lead, middle, trail\n \n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-14539/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14559", "model_patch": "--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -563,9 +563,11 @@\n                     case_statement = Cast(case_statement, output_field=field)\n                 update_kwargs[field.attname] = case_statement\n             updates.append(([obj.pk for obj in batch_objs], update_kwargs))\n+        updated_rows = 0\n         with transaction.atomic(using=self.db, savepoint=False):\n             for pks, update_kwargs in updates:\n-                self.filter(pk__in=pks).update(**update_kwargs)\n+                updated_rows += self.filter(pk__in=pks).update(**update_kwargs)\n+        return updated_rows\n     bulk_update.alters_data = True\n \n     def get_or_create(self, defaults=None, **kwargs):\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-14559/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14580", "model_patch": "--- a/django/db/migrations/serializer.py\n+++ b/django/db/migrations/serializer.py\n@@ -273,7 +273,7 @@\n class TypeSerializer(BaseSerializer):\n     def serialize(self):\n         special_cases = [\n-            (models.Model, \"models.Model\", []),\n+            (models.Model, \"models.Model\", [\"from django.db import models\"]),\n             (type(None), 'type(None)', []),\n         ]\n         for case, string, imports in special_cases:\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-14580/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14608", "model_patch": "--- a/django/forms/formsets.py\n+++ b/django/forms/formsets.py\n@@ -333,7 +333,7 @@\n         self._non_form_errors.\n         \"\"\"\n         self._errors = []\n-        self._non_form_errors = self.error_class()\n+        self._non_form_errors = self.error_class(error_class='nonform')\n         empty_forms_count = 0\n \n         if not self.is_bound:  # Stop further processing.\n@@ -380,7 +380,7 @@\n             # Give self.clean() a chance to do cross-form validation.\n             self.clean()\n         except ValidationError as e:\n-            self._non_form_errors = self.error_class(e.error_list)\n+            self._non_form_errors = self.error_class(e.error_list, error_class='nonform')\n \n     def clean(self):\n         \"\"\"\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-14608/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14631", "model_patch": "--- a/django/forms/forms.py\n+++ b/django/forms/forms.py\n@@ -388,13 +388,15 @@\n \n     def _clean_fields(self):\n         for name, field in self.fields.items():\n+            # Get the BoundField for this field to ensure consistent access\n+            bf = self[name]\n             if field.disabled:\n-                value = self.get_initial_for_field(field, name)\n+                value = bf.initial\n             else:\n-                value = self._field_data_value(field, self.add_prefix(name))\n+                value = bf.data\n             try:\n                 if isinstance(field, FileField):\n-                    initial = self.get_initial_for_field(field, name)\n+                    initial = bf.initial\n                     value = field.clean(value, initial)\n                 else:\n                     value = field.clean(value)\n@@ -434,29 +436,14 @@\n         \"\"\"Return True if data differs from initial.\"\"\"\n         return bool(self.changed_data)\n \n+    def _bound_items(self):\n+        \"\"\"Yield (field_name, BoundField) pairs for all fields in the form.\"\"\"\n+        for name in self.fields:\n+            yield name, self[name]\n+\n     @cached_property\n     def changed_data(self):\n-        data = []\n-        for name, field in self.fields.items():\n-            data_value = self._field_data_value(field, self.add_prefix(name))\n-            if not field.show_hidden_initial:\n-                # Use the BoundField's initial as this is the value passed to\n-                # the widget.\n-                initial_value = self[name].initial\n-            else:\n-                initial_prefixed_name = self.add_initial_prefix(name)\n-                hidden_widget = field.hidden_widget()\n-                try:\n-                    initial_value = field.to_python(\n-                        self._widget_data_value(hidden_widget, initial_prefixed_name)\n-                    )\n-                except ValidationError:\n-                    # Always assume data has changed if validation fails.\n-                    data.append(name)\n-                    continue\n-            if field.has_changed(initial_value, data_value):\n-                data.append(name)\n-        return data\n+        return [name for name, bf in self._bound_items() if bf.did_change()]\n \n     @property\n     def media(self):\n\n--- a/django/forms/boundfield.py\n+++ b/django/forms/boundfield.py\n@@ -232,6 +232,29 @@\n     def widget_type(self):\n         return re.sub(r'widget$|input$', '', self.field.widget.__class__.__name__.lower())\n \n+    def did_change(self):\n+        \"\"\"\n+        Return True if the field's data has changed from its initial value.\n+        \"\"\"\n+        from django.core.exceptions import ValidationError\n+        \n+        data_value = self.form._field_data_value(self.field, self.html_name)\n+        if not self.field.show_hidden_initial:\n+            # Use the BoundField's initial as this is the value passed to\n+            # the widget.\n+            initial_value = self.initial\n+        else:\n+            initial_prefixed_name = self.form.add_initial_prefix(self.name)\n+            hidden_widget = self.field.hidden_widget()\n+            try:\n+                initial_value = self.field.to_python(\n+                    self.form._widget_data_value(hidden_widget, initial_prefixed_name)\n+                )\n+            except ValidationError:\n+                # Always assume data has changed if validation fails.\n+                return True\n+        return self.field.has_changed(initial_value, data_value)\n+\n \n @html_safe\n class BoundWidget:\n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-14631/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14672", "model_patch": "--- a/django/db/models/fields/reverse_related.py\n+++ b/django/db/models/fields/reverse_related.py\n@@ -310,7 +310,7 @@\n     def identity(self):\n         return super().identity + (\n             self.through,\n-            self.through_fields,\n+            make_hashable(self.through_fields),\n             self.db_constraint,\n         )\n \n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-14672/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14725", "model_patch": "--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -573,9 +573,10 @@\n     unique_fields = set()\n \n     def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,\n-                 queryset=None, *, initial=None, **kwargs):\n+                 queryset=None, *, initial=None, can_create=True, **kwargs):\n         self.queryset = queryset\n         self.initial_extra = initial\n+        self.can_create = can_create\n         super().__init__(**{'data': data, 'files': files, 'auto_id': auto_id, 'prefix': prefix, **kwargs})\n \n     def initial_form_count(self):\n@@ -813,6 +814,8 @@\n \n     def save_new_objects(self, commit=True):\n         self.new_objects = []\n+        if not self.can_create:\n+            return self.new_objects\n         for form in self.extra_forms:\n             if not form.has_changed():\n                 continue\n@@ -875,7 +878,8 @@\n                          widgets=None, validate_max=False, localized_fields=None,\n                          labels=None, help_texts=None, error_messages=None,\n                          min_num=None, validate_min=False, field_classes=None,\n-                         absolute_max=None, can_delete_extra=True, renderer=None):\n+                         absolute_max=None, can_delete_extra=True, renderer=None,\n+                         can_create=True):\n     \"\"\"Return a FormSet class for the given Django model class.\"\"\"\n     meta = getattr(form, 'Meta', None)\n     if (getattr(meta, 'fields', fields) is None and\n@@ -896,6 +900,7 @@\n                               absolute_max=absolute_max, can_delete_extra=can_delete_extra,\n                               renderer=renderer)\n     FormSet.model = model\n+    FormSet.can_create = can_create\n     return FormSet\n \n \n", "leaf_id": 15, "source_tree_path": "tmp/trajectory/django__django-14725/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14765", "model_patch": "--- a/django/db/migrations/state.py\n+++ b/django/db/migrations/state.py\n@@ -92,7 +92,8 @@\n         self.models = models or {}\n         # Apps to include from main registry, usually unmigrated ones\n         if real_apps:\n-            self.real_apps = real_apps if isinstance(real_apps, set) else set(real_apps)\n+            assert isinstance(real_apps, set), \"real_apps must be a set when provided\"\n+            self.real_apps = real_apps\n         else:\n             self.real_apps = set()\n         self.is_delayed = False\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-14765/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14771", "model_patch": "--- a/django/utils/autoreload.py\n+++ b/django/utils/autoreload.py\n@@ -220,6 +220,13 @@\n     py_script = Path(sys.argv[0])\n \n     args = [sys.executable] + ['-W%s' % o for o in sys.warnoptions]\n+    # Add -X options from sys._xoptions\n+    if hasattr(sys, '_xoptions'):\n+        for key, value in sys._xoptions.items():\n+            if value is None:\n+                args.append('-X%s' % key)\n+            else:\n+                args.append('-X%s=%s' % (key, value))\n     # __spec__ is set when the server was started with the `-m` option,\n     # see https://docs.python.org/3/reference/import.html#main-spec\n     # __spec__ may not exist, e.g. when running in a Conda env.\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-14771/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14787", "model_patch": "--- a/django/utils/decorators.py\n+++ b/django/utils/decorators.py\n@@ -38,6 +38,7 @@\n         # 'func'. Also, wrap method.__get__() in a function because new\n         # attributes can't be set on bound method objects, only on functions.\n         bound_method = partial(method.__get__(self, type(self)))\n+        update_wrapper(bound_method, method)\n         for dec in decorators:\n             bound_method = dec(bound_method)\n         return bound_method(*args, **kwargs)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-14787/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14792", "model_patch": "--- a/django/db/backends/postgresql/operations.py\n+++ b/django/db/backends/postgresql/operations.py\n@@ -44,6 +44,10 @@\n         return \"DATE_TRUNC('%s', %s)\" % (lookup_type, field_name)\n \n     def _prepare_tzname_delta(self, tzname):\n+        # Handle Etc/GMT timezone names - these should not have their signs reversed\n+        if tzname.startswith('Etc/GMT'):\n+            return tzname\n+        # Handle numeric timezone offsets by reversing the sign\n         if '+' in tzname:\n             return tzname.replace('+', '-')\n         elif '-' in tzname:\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-14792/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14855", "model_patch": "--- a/django/contrib/admin/helpers.py\n+++ b/django/contrib/admin/helpers.py\n@@ -209,7 +209,11 @@\n             remote_field.model._meta.model_name,\n         )\n         try:\n-            url = reverse(url_name, args=[quote(remote_obj.pk)])\n+            url = reverse(\n+                url_name,\n+                args=[quote(remote_obj.pk)],\n+                current_app=self.model_admin.admin_site.name\n+            )\n             return format_html('<a href=\"{}\">{}</a>', url, remote_obj)\n         except NoReverseMatch:\n             return str(remote_obj)\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-14855/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14915", "model_patch": "--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -1171,6 +1171,9 @@\n             other = other.value\n         return self.value == other\n \n+    def __hash__(self):\n+        return hash(self.value)\n+\n \n class ModelChoiceIterator:\n     def __init__(self, field):\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-14915/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-14999", "model_patch": "--- a/django/db/migrations/operations/models.py\n+++ b/django/db/migrations/operations/models.py\n@@ -320,6 +320,9 @@\n         new_model = to_state.apps.get_model(app_label, self.new_name)\n         if self.allow_migrate_model(schema_editor.connection.alias, new_model):\n             old_model = from_state.apps.get_model(app_label, self.old_name)\n+            # If db_table is the same, this is a noop\n+            if old_model._meta.db_table == new_model._meta.db_table:\n+                return\n             # Move the main table\n             schema_editor.alter_db_table(\n                 new_model,\n", "leaf_id": 11, "source_tree_path": "tmp/trajectory/django__django-14999/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15022", "model_patch": "--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -1031,6 +1031,7 @@\n         if search_fields and search_term:\n             orm_lookups = [construct_search(str(search_field))\n                            for search_field in search_fields]\n+            and_queries = []\n             for bit in smart_split(search_term):\n                 if bit.startswith(('\"', \"'\")) and bit[0] == bit[-1]:\n                     bit = unescape_string_literal(bit)\n@@ -1038,7 +1039,9 @@\n                     *((orm_lookup, bit) for orm_lookup in orm_lookups),\n                     _connector=models.Q.OR,\n                 )\n-                queryset = queryset.filter(or_queries)\n+                and_queries.append(or_queries)\n+            if and_queries:\n+                queryset = queryset.filter(*and_queries)\n             may_have_duplicates |= any(\n                 lookup_spawns_duplicates(self.opts, search_spec)\n                 for search_spec in orm_lookups\n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-15022/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15037", "model_patch": "--- a/django/core/management/commands/inspectdb.py\n+++ b/django/core/management/commands/inspectdb.py\n@@ -124,6 +124,17 @@\n                             \"self\" if relations[column_name][1] == table_name\n                             else table2model(relations[column_name][1])\n                         )\n+                        # Check if the referenced field is not the primary key\n+                        referenced_field_name = relations[column_name][0]\n+                        referenced_table_name = relations[column_name][1]\n+                        try:\n+                            referenced_primary_key = connection.introspection.get_primary_key_column(cursor, referenced_table_name)\n+                            if referenced_field_name != referenced_primary_key:\n+                                extra_params['to_field'] = referenced_field_name\n+                        except Exception:\n+                            # If we can't determine the primary key, skip adding to_field\n+                            pass\n+                        \n                         if rel_to in known_models:\n                             field_type = '%s(%s' % (rel_type, rel_to)\n                         else:\n", "leaf_id": 12, "source_tree_path": "tmp/trajectory/django__django-15037/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15098", "model_patch": "--- a/django/utils/translation/trans_real.py\n+++ b/django/utils/translation/trans_real.py\n@@ -43,7 +43,7 @@\n     re.IGNORECASE\n )\n \n-language_code_prefix_re = _lazy_re_compile(r'^/(\\w+([@-]\\w+)?)(/|$)')\n+language_code_prefix_re = _lazy_re_compile(r'^/([a-z]{1,8}(?:-[a-z0-9]{1,8})*(?:@[a-z0-9]{1,20})?)(/|$)', re.IGNORECASE)\n \n \n @receiver(setting_changed)\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-15098/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15103", "model_patch": "--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -83,7 +83,7 @@\n \n \n @register.filter(is_safe=True)\n-def json_script(value, element_id):\n+def json_script(value, element_id=None):\n     \"\"\"\n     Output value JSON-encoded, wrapped in a <script type=\"application/json\">\n     tag.\n\n--- a/django/utils/html.py\n+++ b/django/utils/html.py\n@@ -61,7 +61,7 @@\n }\n \n \n-def json_script(value, element_id):\n+def json_script(value, element_id=None):\n     \"\"\"\n     Escape all the HTML/XML special characters with their unicode escapes, so\n     value is safe to be output anywhere except for inside a tag attribute. Wrap\n@@ -69,10 +69,16 @@\n     \"\"\"\n     from django.core.serializers.json import DjangoJSONEncoder\n     json_str = json.dumps(value, cls=DjangoJSONEncoder).translate(_json_script_escapes)\n-    return format_html(\n-        '<script id=\"{}\" type=\"application/json\">{}</script>',\n-        element_id, mark_safe(json_str)\n-    )\n+    if element_id is None:\n+        return format_html(\n+            '<script type=\"application/json\">{}</script>',\n+            mark_safe(json_str)\n+        )\n+    else:\n+        return format_html(\n+            '<script id=\"{}\" type=\"application/json\">{}</script>',\n+            element_id, mark_safe(json_str)\n+        )\n \n \n def conditional_escape(text):\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-15103/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15104", "model_patch": "--- a/django/db/migrations/autodetector.py\n+++ b/django/db/migrations/autodetector.py\n@@ -96,7 +96,7 @@\n         for name, field in sorted(fields.items()):\n             deconstruction = self.deep_deconstruct(field)\n             if field.remote_field and field.remote_field.model:\n-                del deconstruction[2]['to']\n+                deconstruction[2].pop('to', None)\n             fields_def.append(deconstruction)\n         return fields_def\n \n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-15104/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15127", "model_patch": "--- a/django/contrib/messages/storage/base.py\n+++ b/django/contrib/messages/storage/base.py\n@@ -38,7 +38,7 @@\n \n     @property\n     def level_tag(self):\n-        return LEVEL_TAGS.get(self.level, '')\n+        return utils.get_level_tags().get(self.level, '')\n \n \n class BaseStorage:\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-15127/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15161", "model_patch": "--- a/django/db/models/expressions.py\n+++ b/django/db/models/expressions.py\n@@ -651,6 +651,7 @@\n         return self\n \n \n+@deconstructible(path='django.db.models.Func')\n class Func(SQLiteNumericMixin, Expression):\n     \"\"\"An SQL function call.\"\"\"\n     function = None\n@@ -731,6 +732,7 @@\n         return copy\n \n \n+@deconstructible(path='django.db.models.Value')\n class Value(SQLiteNumericMixin, Expression):\n     \"\"\"Represent a wrapped value as a node within an expression.\"\"\"\n     # Provide a default value for `for_save` in order to allow unresolved\n", "leaf_id": 19, "source_tree_path": "tmp/trajectory/django__django-15161/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15252", "model_patch": "--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -1,5 +1,5 @@\n from django.apps.registry import Apps\n-from django.db import DatabaseError, models\n+from django.db import DatabaseError, models, router\n from django.utils.functional import classproperty\n from django.utils.timezone import now\n \n@@ -62,6 +62,9 @@\n         # in the codebase.\n         if self.has_table():\n             return\n+        # Check if migrations are allowed on this database\n+        if not router.allow_migrate(self.connection.alias, 'migrations', model_name='migration'):\n+            return\n         # Make the table\n         try:\n             with self.connection.schema_editor() as editor:\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-15252/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15268", "model_patch": "--- a/django/db/migrations/operations/models.py\n+++ b/django/db/migrations/operations/models.py\n@@ -524,6 +524,18 @@\n     def describe(self):\n         return \"Alter %s for %s (%s constraint(s))\" % (self.option_name, self.name, len(self.option_value or ''))\n \n+    def reduce(self, operation, app_label):\n+        if (isinstance(operation, AlterTogetherOptionOperation) and\n+                self.name_lower == operation.name_lower and\n+                type(self) is type(operation)):\n+            return [\n+                type(self)(\n+                    self.name,\n+                    operation.option_value,\n+                ),\n+            ]\n+        return super().reduce(operation, app_label)\n+\n     @property\n     def migration_name_fragment(self):\n         return 'alter_%s_%s' % (self.name_lower, self.option_name)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-15268/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15277", "model_patch": "--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -1010,7 +1010,8 @@\n     def __init__(self, *args, db_collation=None, **kwargs):\n         super().__init__(*args, **kwargs)\n         self.db_collation = db_collation\n-        self.validators.append(validators.MaxLengthValidator(self.max_length))\n+        if self.max_length is not None:\n+            self.validators.append(validators.MaxLengthValidator(self.max_length))\n \n     def check(self, **kwargs):\n         databases = kwargs.get('databases') or []\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-15277/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15278", "model_patch": "--- a/django/db/backends/sqlite3/schema.py\n+++ b/django/db/backends/sqlite3/schema.py\n@@ -327,7 +327,9 @@\n         # Fields with default values cannot by handled by ALTER TABLE ADD\n         # COLUMN statement because DROP DEFAULT is not supported in\n         # ALTER TABLE.\n-        if not field.null or self.effective_default(field) is not None:\n+        # Fields with unique constraints also cannot be handled by ALTER TABLE\n+        # ADD COLUMN statement because SQLite doesn't support adding UNIQUE columns.\n+        if not field.null or self.effective_default(field) is not None or field.unique:\n             self._remake_table(model, create_field=field)\n         else:\n             super().add_field(model, field)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-15278/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15368", "model_patch": "--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -670,7 +670,7 @@\n                 when_statements = []\n                 for obj in batch_objs:\n                     attr = getattr(obj, field.attname)\n-                    if not isinstance(attr, Expression):\n+                    if not hasattr(attr, 'resolve_expression'):\n                         attr = Value(attr, output_field=field)\n                     when_statements.append(When(pk=obj.pk, then=attr))\n                 case_statement = Case(*when_statements, output_field=field)\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-15368/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15375", "model_patch": "--- a/django/db/models/aggregates.py\n+++ b/django/db/models/aggregates.py\n@@ -65,7 +65,9 @@\n         if hasattr(default, 'resolve_expression'):\n             default = default.resolve_expression(query, allow_joins, reuse, summarize)\n         c.default = None  # Reset the default argument before wrapping.\n-        return Coalesce(c, default, output_field=c._output_field_or_none)\n+        coalesce = Coalesce(c, default, output_field=c._output_field_or_none)\n+        coalesce.is_summary = True\n+        return coalesce\n \n     @property\n     def default_alias(self):\n", "leaf_id": 18, "source_tree_path": "tmp/trajectory/django__django-15375/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15380", "model_patch": "--- a/django/db/migrations/autodetector.py\n+++ b/django/db/migrations/autodetector.py\n@@ -824,7 +824,7 @@\n         for app_label, model_name, field_name in sorted(self.new_field_keys - self.old_field_keys):\n             old_model_name = self.renamed_models.get((app_label, model_name), model_name)\n             old_model_state = self.from_state.models[app_label, old_model_name]\n-            new_model_state = self.to_state.models[app_label, old_model_name]\n+            new_model_state = self.to_state.models[app_label, model_name]\n             field = new_model_state.get_field(field_name)\n             # Scan to see if this is actually a rename!\n             field_dec = self.deep_deconstruct(field)\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-15380/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15467", "model_patch": "--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -269,7 +269,7 @@\n                         \"class\": get_ul_class(self.radio_fields[db_field.name]),\n                     }\n                 )\n-                kwargs[\"empty_label\"] = _(\"None\") if db_field.blank else None\n+                kwargs[\"empty_label\"] = (kwargs.get('empty_label') or _(\"None\")) if db_field.blank else None\n \n         if \"queryset\" not in kwargs:\n             queryset = self.get_field_queryset(db, db_field, request)\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-15467/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15499", "model_patch": "--- a/django/db/migrations/operations/models.py\n+++ b/django/db/migrations/operations/models.py\n@@ -168,6 +168,19 @@\n                     options=options,\n                     bases=self.bases,\n                     managers=self.managers,\n+                ),\n+            ]\n+        elif (\n+            isinstance(operation, AlterModelManagers)\n+            and self.name_lower == operation.name_lower\n+        ):\n+            return [\n+                CreateModel(\n+                    self.name,\n+                    fields=self.fields,\n+                    options=self.options,\n+                    bases=self.bases,\n+                    managers=operation.managers,\n                 ),\n             ]\n         elif (\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-15499/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15503", "model_patch": "--- a/django/db/models/fields/json.py\n+++ b/django/db/models/fields/json.py\n@@ -126,16 +126,21 @@\n         )\n \n \n-def compile_json_path(key_transforms, include_root=True):\n+def compile_json_path(key_transforms, include_root=True, force_property_access=False):\n     path = [\"$\"] if include_root else []\n     for key_transform in key_transforms:\n-        try:\n-            num = int(key_transform)\n-        except ValueError:  # non-integer\n+        if force_property_access:\n+            # Force all keys to be treated as object properties\n             path.append(\".\")\n             path.append(json.dumps(key_transform))\n         else:\n-            path.append(\"[%s]\" % num)\n+            try:\n+                num = int(key_transform)\n+            except ValueError:  # non-integer\n+                path.append(\".\")\n+                path.append(json.dumps(key_transform))\n+            else:\n+                path.append(\"[%s]\" % num)\n     return \"\".join(path)\n \n \n@@ -197,7 +202,7 @@\n                 \"%s%s\"\n                 % (\n                     lhs_json_path,\n-                    compile_json_path(rhs_key_transforms, include_root=False),\n+                    compile_json_path(rhs_key_transforms, include_root=False, force_property_access=True),\n                 )\n             )\n         # Add condition for each key.\n", "leaf_id": 11, "source_tree_path": "tmp/trajectory/django__django-15503/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15525", "model_patch": "--- a/django/core/serializers/base.py\n+++ b/django/core/serializers/base.py\n@@ -336,7 +336,9 @@\n         and hasattr(default_manager, \"get_by_natural_key\")\n         and hasattr(Model, \"natural_key\")\n     ):\n-        natural_key = Model(**data).natural_key()\n+        temp_instance = Model(**data)\n+        temp_instance._state.db = db\n+        natural_key = temp_instance.natural_key()\n         try:\n             data[Model._meta.pk.attname] = Model._meta.pk.to_python(\n                 default_manager.db_manager(db).get_by_natural_key(*natural_key).pk\n", "leaf_id": 6, "source_tree_path": "tmp/trajectory/django__django-15525/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15554", "model_patch": "--- a/django/db/models/sql/datastructures.py\n+++ b/django/db/models/sql/datastructures.py\n@@ -162,8 +162,8 @@\n         return hash(self.identity)\n \n     def equals(self, other):\n-        # Ignore filtered_relation in equality check.\n-        return self.identity[:-1] == other.identity[:-1]\n+        # Include filtered_relation in equality check.\n+        return self.identity == other.identity\n \n     def demote(self):\n         new = self.relabeled_clone({})\n", "leaf_id": 11, "source_tree_path": "tmp/trajectory/django__django-15554/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15561", "model_patch": "--- a/django/db/backends/base/schema.py\n+++ b/django/db/backends/base/schema.py\n@@ -1378,6 +1378,7 @@\n         # - adding only a db_column and the column name is not changed\n         non_database_attrs = [\n             \"blank\",\n+            \"choices\",\n             \"db_column\",\n             \"editable\",\n             \"error_messages\",\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-15561/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15563", "model_patch": "--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -1836,7 +1836,20 @@\n         query.clear_ordering(force=True)\n         query.extra = {}\n         query.select = []\n-        query.add_fields([query.get_meta().pk.name])\n+        \n+        # For related updates, we need to collect primary keys for each parent model\n+        if self.query.related_updates:\n+            # Add fields for each related model's primary key\n+            for related_model in self.query.related_updates.keys():\n+                # Get the field that links child to this parent\n+                for parent in query.get_meta().parents.values():\n+                    if parent.remote_field.model == related_model:\n+                        query.add_fields([parent.name])\n+                        break\n+        else:\n+            # For non-related updates, use the main model's primary key\n+            query.add_fields([query.get_meta().pk.name])\n+            \n         super().pre_sql_setup()\n \n         must_pre_select = (\n@@ -1850,11 +1863,48 @@\n             # Either we're using the idents in multiple update queries (so\n             # don't want them to change), or the db backend doesn't support\n             # selecting from the updating table (e.g. MySQL).\n-            idents = []\n-            for rows in query.get_compiler(self.using).execute_sql(MULTI):\n-                idents.extend(r[0] for r in rows)\n-            self.query.add_filter(\"pk__in\", idents)\n-            self.query.related_ids = idents\n+            \n+            if self.query.related_updates:\n+                # For related updates, collect primary keys for each parent model\n+                related_ids_map = {}\n+                result_rows = list(query.get_compiler(self.using).execute_sql(MULTI))\n+                \n+                field_index = 0\n+                for related_model in self.query.related_updates.keys():\n+                    # Find the corresponding parent field\n+                    for parent in query.get_meta().parents.values():\n+                        if parent.remote_field.model == related_model:\n+                            idents = []\n+                            for rows in result_rows:\n+                                for row in rows:\n+                                    if len(row) > field_index and row[field_index] is not None:\n+                                        idents.append(row[field_index])\n+                            related_ids_map[related_model] = idents\n+                            field_index += 1\n+                            break\n+                \n+                # Store the mapping for use in get_related_updates\n+                self.query.related_ids_map = related_ids_map\n+                \n+                # For the main query filter, use the child model's primary key\n+                main_query = self.query.chain(klass=Query)\n+                main_query.select_related = False\n+                main_query.clear_ordering(force=True)\n+                main_query.extra = {}\n+                main_query.select = []\n+                main_query.add_fields([main_query.get_meta().pk.name])\n+                \n+                idents = []\n+                for rows in main_query.get_compiler(self.using).execute_sql(MULTI):\n+                    idents.extend(r[0] for r in rows)\n+                self.query.add_filter(\"pk__in\", idents)\n+                self.query.related_ids = idents\n+            else:\n+                idents = []\n+                for rows in query.get_compiler(self.using).execute_sql(MULTI):\n+                    idents.extend(r[0] for r in rows)\n+                self.query.add_filter(\"pk__in\", idents)\n+                self.query.related_ids = idents\n         else:\n             # The fast path. Filters and updates in one query.\n             self.query.add_filter(\"pk__in\", query)\n", "leaf_id": 19, "source_tree_path": "tmp/trajectory/django__django-15563/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15569", "model_patch": "--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -217,6 +217,7 @@\n         if lookup_name is None:\n             lookup_name = lookup.lookup_name\n         del cls.class_lookups[lookup_name]\n+        cls._clear_cached_lookups()\n \n \n def select_related_descend(field, restricted, requested, load_fields, reverse=False):\n", "leaf_id": 7, "source_tree_path": "tmp/trajectory/django__django-15569/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15572", "model_patch": "--- a/django/template/autoreload.py\n+++ b/django/template/autoreload.py\n@@ -17,7 +17,7 @@\n         if not isinstance(backend, DjangoTemplates):\n             continue\n \n-        items.update(cwd / to_path(dir) for dir in backend.engine.dirs)\n+        items.update(cwd / to_path(dir) for dir in backend.engine.dirs if dir)\n \n         for loader in backend.engine.template_loaders:\n             if not hasattr(loader, \"get_dirs\"):\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-15572/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15629", "model_patch": "--- a/django/db/backends/base/schema.py\n+++ b/django/db/backends/base/schema.py\n@@ -1038,6 +1038,10 @@\n         for old_rel, new_rel in rels_to_update:\n             rel_db_params = new_rel.field.db_parameters(connection=self.connection)\n             rel_type = rel_db_params[\"type\"]\n+            # Include collation from target field if present\n+            target_field_db_params = new_rel.field.target_field.db_parameters(connection=self.connection)\n+            if target_collation := target_field_db_params.get(\"collation\"):\n+                rel_type += self._collate_sql(target_collation)\n             fragment, other_actions = self._alter_column_type_sql(\n                 new_rel.related_model, old_rel.field, new_rel.field, rel_type\n             )\n", "leaf_id": 19, "source_tree_path": "tmp/trajectory/django__django-15629/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15695", "model_patch": "--- a/django/db/migrations/operations/models.py\n+++ b/django/db/migrations/operations/models.py\n@@ -931,6 +931,24 @@\n                 app_label, self.model_name_lower, self.old_name, self.new_name\n             )\n \n+    def state_backwards(self, app_label, state):\n+        if self.old_fields:\n+            state.remove_index(\n+                app_label,\n+                self.model_name_lower,\n+                self.new_name,\n+            )\n+            state.add_model_options(\n+                app_label,\n+                self.model_name_lower,\n+                AlterIndexTogether.option_name,\n+                self.old_fields,\n+            )\n+        else:\n+            state.rename_index(\n+                app_label, self.model_name_lower, self.new_name, self.old_name\n+            )\n+\n     def database_forwards(self, app_label, schema_editor, from_state, to_state):\n         model = to_state.apps.get_model(app_label, self.model_name)\n         if not self.allow_migrate_model(schema_editor.connection.alias, model):\n@@ -966,23 +984,53 @@\n         schema_editor.rename_index(model, old_index, new_index)\n \n     def database_backwards(self, app_label, schema_editor, from_state, to_state):\n+        model = to_state.apps.get_model(app_label, self.model_name)\n+        if not self.allow_migrate_model(schema_editor.connection.alias, model):\n+            return\n+\n         if self.old_fields:\n-            # Backward operation with unnamed index is a no-op.\n-            return\n-\n-        self.new_name_lower, self.old_name_lower = (\n-            self.old_name_lower,\n-            self.new_name_lower,\n-        )\n-        self.new_name, self.old_name = self.old_name, self.new_name\n-\n-        self.database_forwards(app_label, schema_editor, from_state, to_state)\n-\n-        self.new_name_lower, self.old_name_lower = (\n-            self.old_name_lower,\n-            self.new_name_lower,\n-        )\n-        self.new_name, self.old_name = self.old_name, self.new_name\n+            # For unnamed indexes, we need to rename back to the auto-generated name\n+            to_model = to_state.apps.get_model(app_label, self.model_name)\n+            columns = [\n+                to_model._meta.get_field(field).column for field in self.old_fields\n+            ]\n+            matching_index_name = schema_editor._constraint_names(\n+                to_model, column_names=columns, index=True\n+            )\n+            if len(matching_index_name) != 1:\n+                raise ValueError(\n+                    \"Found wrong number (%s) of indexes for %s(%s).\"\n+                    % (\n+                        len(matching_index_name),\n+                        to_model._meta.db_table,\n+                        \", \".join(columns),\n+                    )\n+                )\n+            # Current index with new_name\n+            old_index = models.Index(\n+                fields=self.old_fields,\n+                name=self.new_name,\n+            )\n+            # Target index with auto-generated name\n+            new_index = models.Index(\n+                fields=self.old_fields,\n+                name=matching_index_name[0],\n+            )\n+            schema_editor.rename_index(model, old_index, new_index)\n+        else:\n+            self.new_name_lower, self.old_name_lower = (\n+                self.old_name_lower,\n+                self.new_name_lower,\n+            )\n+            self.new_name, self.old_name = self.old_name, self.new_name\n+\n+            self.database_forwards(app_label, schema_editor, from_state, to_state)\n+\n+            self.new_name_lower, self.old_name_lower = (\n+                self.old_name_lower,\n+                self.new_name_lower,\n+            )\n+            self.new_name, self.old_name = self.old_name, self.new_name\n \n     def describe(self):\n         if self.old_name:\n", "leaf_id": 15, "source_tree_path": "tmp/trajectory/django__django-15695/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15731", "model_patch": "--- a/django/db/models/manager.py\n+++ b/django/db/models/manager.py\n@@ -1,4 +1,5 @@\n import copy\n+import functools\n import inspect\n from importlib import import_module\n \n@@ -81,11 +82,10 @@\n     @classmethod\n     def _get_queryset_methods(cls, queryset_class):\n         def create_method(name, method):\n+            @functools.wraps(method)\n             def manager_method(self, *args, **kwargs):\n                 return getattr(self.get_queryset(), name)(*args, **kwargs)\n \n-            manager_method.__name__ = method.__name__\n-            manager_method.__doc__ = method.__doc__\n             return manager_method\n \n         new_methods = {}\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-15731/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15732", "model_patch": "--- a/django/db/backends/base/schema.py\n+++ b/django/db/backends/base/schema.py\n@@ -566,6 +566,7 @@\n             model,\n             columns,\n             exclude=meta_constraint_names | meta_index_names,\n+            primary_key=False,\n             **constraint_kwargs,\n         )\n         if len(constraint_names) != 1:\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-15732/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15741", "model_patch": "--- a/django/utils/formats.py\n+++ b/django/utils/formats.py\n@@ -7,6 +7,7 @@\n \n from django.conf import settings\n from django.utils import dateformat, numberformat\n+from django.utils.encoding import force_str\n from django.utils.functional import lazy\n from django.utils.translation import check_for_language, get_language, to_locale\n \n@@ -106,6 +107,7 @@\n     If use_l10n is provided and is not None, it forces the value to\n     be localized (or not), overriding the value of settings.USE_L10N.\n     \"\"\"\n+    format_type = force_str(format_type)\n     if use_l10n is None:\n         try:\n             use_l10n = settings._USE_L10N_INTERNAL\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-15741/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15814", "model_patch": "--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -748,7 +748,7 @@\n                     cur_model = source.related_model\n                 else:\n                     cur_model = source.remote_field.model\n-                opts = cur_model._meta\n+                opts = cur_model._meta.concrete_model._meta\n                 # Even if we're \"just passing through\" this model, we must add\n                 # both the current model's pk and the related reference field\n                 # (if it's not a reverse relation) to the things we select.\n\n--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -2596,7 +2596,7 @@\n             )\n \n         self.model_cls = klass_info[\"model\"]\n-        self.pk_idx = self.init_list.index(self.model_cls._meta.pk.attname)\n+        self.pk_idx = self.init_list.index(self.model_cls._meta.concrete_model._meta.pk.attname)\n         self.related_populators = get_related_populators(klass_info, select, self.db)\n         self.local_setter = klass_info[\"local_setter\"]\n         self.remote_setter = klass_info[\"remote_setter\"]\n", "leaf_id": 9, "source_tree_path": "tmp/trajectory/django__django-15814/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15851", "model_patch": "--- a/django/db/backends/postgresql/client.py\n+++ b/django/db/backends/postgresql/client.py\n@@ -32,9 +32,9 @@\n             args += [\"-h\", host]\n         if port:\n             args += [\"-p\", str(port)]\n+        args.extend(parameters)\n         if dbname:\n             args += [dbname]\n-        args.extend(parameters)\n \n         env = {}\n         if passwd:\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-15851/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15863", "model_patch": "--- a/django/template/defaultfilters.py\n+++ b/django/template/defaultfilters.py\n@@ -155,7 +155,11 @@\n         d = Decimal(input_val)\n     except InvalidOperation:\n         try:\n-            d = Decimal(str(float(text)))\n+            # Check if input is already a Decimal to preserve precision\n+            if isinstance(text, Decimal):\n+                d = text\n+            else:\n+                d = Decimal(str(float(text)))\n         except (ValueError, InvalidOperation, TypeError):\n             return \"\"\n     try:\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-15863/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15930", "model_patch": "--- a/django/db/models/expressions.py\n+++ b/django/db/models/expressions.py\n@@ -1298,7 +1298,16 @@\n         connection.ops.check_expression_support(self)\n         template_params = extra_context\n         sql_params = []\n-        condition_sql, condition_params = compiler.compile(self.condition)\n+        try:\n+            condition_sql, condition_params = compiler.compile(self.condition)\n+        except EmptyResultSet:\n+            # Handle empty result sets by providing appropriate SQL fallbacks\n+            # For negated empty conditions like ~Q(pk__in=[]), use '1 = 1' (always true)\n+            # For non-negated empty conditions, use '0 = 1' (always false)\n+            if getattr(self.condition, 'negated', False):\n+                condition_sql, condition_params = '1 = 1', []\n+            else:\n+                condition_sql, condition_params = '0 = 1', []\n         template_params[\"condition\"] = condition_sql\n         sql_params.extend(condition_params)\n         result_sql, result_params = compiler.compile(self.result)\n", "leaf_id": 15, "source_tree_path": "tmp/trajectory/django__django-15930/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15957", "model_patch": "--- a/django/db/models/fields/related_descriptors.py\n+++ b/django/db/models/fields/related_descriptors.py\n@@ -659,6 +659,20 @@\n             empty_strings_as_null = connections[\n                 db\n             ].features.interprets_empty_strings_as_nulls\n+            \n+            # Check if the queryset has been sliced\n+            slice_start = None\n+            slice_stop = None\n+            slice_step = None\n+            if hasattr(queryset.query, 'low_mark') and hasattr(queryset.query, 'high_mark'):\n+                if queryset.query.low_mark is not None or queryset.query.high_mark is not None:\n+                    slice_start = queryset.query.low_mark\n+                    slice_stop = queryset.query.high_mark\n+                    # Create a new unsliced queryset from the same model and database\n+                    queryset = queryset.model._default_manager.all()\n+                    if hasattr(queryset, '_db') and queryset._db:\n+                        queryset = queryset.using(queryset._db)\n+            \n             queryset._add_hints(instance=self.instance)\n             if self._db:\n                 queryset = queryset.using(self._db)\n@@ -689,6 +703,11 @@\n                 queryset._known_related_objects = {\n                     self.field: {rel_obj_id: self.instance}\n                 }\n+            \n+            # Re-apply the original slice if it existed\n+            if slice_start is not None or slice_stop is not None:\n+                queryset = queryset[slice_start:slice_stop]\n+            \n             return queryset\n \n         def _remove_prefetched_objects(self):\n", "leaf_id": 16, "source_tree_path": "tmp/trajectory/django__django-15957/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15973", "model_patch": "--- a/django/db/backends/base/schema.py\n+++ b/django/db/backends/base/schema.py\n@@ -450,15 +450,21 @@\n \n         # Make M2M tables\n         for field in model._meta.local_many_to_many:\n-            if field.remote_field.through._meta.auto_created:\n-                self.create_model(field.remote_field.through)\n+            through = field.remote_field.through\n+            if isinstance(through, str):\n+                through = model._meta.apps.get_model(through)\n+            if through._meta.auto_created:\n+                self.create_model(through)\n \n     def delete_model(self, model):\n         \"\"\"Delete a model from the database.\"\"\"\n         # Handle auto-created intermediary models\n         for field in model._meta.local_many_to_many:\n-            if field.remote_field.through._meta.auto_created:\n-                self.delete_model(field.remote_field.through)\n+            through = field.remote_field.through\n+            if isinstance(through, str):\n+                through = model._meta.apps.get_model(through)\n+            if through._meta.auto_created:\n+                self.delete_model(through)\n \n         # Delete the table\n         self.execute(\n", "leaf_id": 13, "source_tree_path": "tmp/trajectory/django__django-15973/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-15987", "model_patch": "--- a/django/core/management/commands/loaddata.py\n+++ b/django/core/management/commands/loaddata.py\n@@ -362,7 +362,7 @@\n         \"\"\"\n         dirs = []\n         fixture_dirs = settings.FIXTURE_DIRS\n-        if len(fixture_dirs) != len(set(fixture_dirs)):\n+        if len(fixture_dirs) != len(set(str(d) for d in fixture_dirs)):\n             raise ImproperlyConfigured(\"settings.FIXTURE_DIRS contains duplicates.\")\n         for app_config in apps.get_app_configs():\n             app_label = app_config.label\n", "leaf_id": 4, "source_tree_path": "tmp/trajectory/django__django-15987/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16032", "model_patch": "--- a/django/db/models/lookups.py\n+++ b/django/db/models/lookups.py\n@@ -420,9 +420,8 @@\n \n         if isinstance(self.rhs, Query):\n             self.rhs.clear_ordering(clear_default=True)\n-            if not self.rhs.has_select_fields:\n-                self.rhs.clear_select_clause()\n-                self.rhs.add_fields([\"pk\"])\n+            self.rhs.clear_select_clause()\n+            self.rhs.add_fields([\"pk\"])\n         return super().get_prep_lookup()\n \n     def process_rhs(self, compiler, connection):\n", "leaf_id": 10, "source_tree_path": "tmp/trajectory/django__django-16032/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16082", "model_patch": "--- a/django/db/models/expressions.py\n+++ b/django/db/models/expressions.py\n@@ -533,6 +533,7 @@\n             Combinable.SUB,\n             Combinable.MUL,\n             Combinable.DIV,\n+            Combinable.MOD,\n         )\n     },\n     # Bitwise operators.\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16082/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16116", "model_patch": "--- a/django/core/management/commands/makemigrations.py\n+++ b/django/core/management/commands/makemigrations.py\n@@ -248,12 +248,14 @@\n                 else:\n                     self.log(\"No changes detected\")\n         else:\n+            # If --check is specified, exit immediately after detecting changes\n+            # without writing any migration files\n+            if check_changes:\n+                sys.exit(1)\n             if self.update:\n                 self.write_to_last_migration_files(changes)\n             else:\n                 self.write_migration_files(changes)\n-            if check_changes:\n-                sys.exit(1)\n \n     def write_to_last_migration_files(self, changes):\n         loader = MigrationLoader(connections[DEFAULT_DB_ALIAS])\n", "leaf_id": 5, "source_tree_path": "tmp/trajectory/django__django-16116/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16136", "model_patch": "--- a/django/views/generic/base.py\n+++ b/django/views/generic/base.py\n@@ -148,7 +148,16 @@\n             request.path,\n             extra={\"status_code\": 405, \"request\": request},\n         )\n-        return HttpResponseNotAllowed(self._allowed_methods())\n+        response = HttpResponseNotAllowed(self._allowed_methods())\n+        \n+        if self.view_is_async:\n+\n+            async def func():\n+                return response\n+\n+            return func()\n+        else:\n+            return response\n \n     def options(self, request, *args, **kwargs):\n         \"\"\"Handle responding to requests for the OPTIONS HTTP verb.\"\"\"\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16136/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16139", "model_patch": "--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -163,7 +163,7 @@\n         super().__init__(*args, **kwargs)\n         password = self.fields.get(\"password\")\n         if password:\n-            password.help_text = password.help_text.format(\"../password/\")\n+            password.help_text = password.help_text.format(f\"../../{self.instance.pk}/password/\")\n         user_permissions = self.fields.get(\"user_permissions\")\n         if user_permissions:\n             user_permissions.queryset = user_permissions.queryset.select_related(\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16139/2025-11-28_trajectory.json"}
{"model_name_or_path": "DeepSeek_IA", "instance_id": "django__django-16145", "model_patch": "--- a/django/core/management/commands/runserver.py\n+++ b/django/core/management/commands/runserver.py\n@@ -147,7 +147,7 @@\n                 \"version\": self.get_version(),\n                 \"settings\": settings.SETTINGS_MODULE,\n                 \"protocol\": self.protocol,\n-                \"addr\": \"[%s]\" % self.addr if self._raw_ipv6 else self.addr,\n+                \"addr\": \"[%s]\" % self.addr if self._raw_ipv6 else (\"0.0.0.0\" if self.addr == \"0\" else self.addr),\n                 \"port\": self.port,\n                 \"quit_command\": quit_command,\n             }\n", "leaf_id": 3, "source_tree_path": "tmp/trajectory/django__django-16145/2025-11-28_trajectory.json"}
